const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vanta.cells.min-C2JetcJo.js","assets/index-UkIvKgPy.js","assets/index-CBB7irxW.css"])))=>i.map(i=>d[i]);
import{s as L,r as n,j as e,_ as M}from"./index-UkIvKgPy.js";const q="https://ccogznilfcqzpqtvbcne.supabase.co",S="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNjb2d6bmlsZmNxenBxdHZiY25lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY3NDI3ODAsImV4cCI6MjA4MjMxODc4MH0.gsR9RFWsS_-AAvDMuyXuGahnbkm-xTBgsxwHkSOMqXM";async function F(c,w,g,r){try{const u=await fetch(`${q}/functions/v1/send-otp`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${S}`,apikey:S},body:JSON.stringify({email:c.trim(),firstName:w?.trim()||"",lastName:g?.trim()||"",password:r})}),i=await u.json();if(!u.ok){if(i?.requiresLogin)return{success:!1,error:i.error||"An account with this email already exists",requiresLogin:!0};throw new Error(i.error||i.message||"Failed to send OTP")}return i?.error?{success:!1,error:i.error,requiresLogin:i.requiresLogin||!1}:{success:!0}}catch(u){return console.error("Error sending OTP:",u),{success:!1,error:u.message||"Failed to send OTP. Please try again."}}}async function K(c,w){try{const g=await fetch(`${q}/functions/v1/verify-otp`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${S}`,apikey:S},body:JSON.stringify({email:c.trim(),code:w.trim()})}),r=await g.json();if(!g.ok)throw new Error(r.error||r.message||"Failed to verify OTP");if(r?.error)return{success:!1,error:r.error};if(r?.session&&r?.user){const{error:u}=await L.auth.setSession({access_token:r.session.access_token,refresh_token:r.session.refresh_token});return u?(console.error("Error setting session:",u),{success:!1,error:"Failed to create session. Please try again."}):{success:!0,user:r.user,session:r.session}}return r?.requiresPasswordLogin?{success:!0,user:r.user,requiresPasswordLogin:!0,message:r.message||"Account created successfully. Please log in with your password to continue."}:r?.requiresLogin?{success:!1,error:r.error||"An account with this email already exists. Please log in instead.",requiresLogin:!0}:{success:!1,error:"Invalid response from server"}}catch(g){return console.error("Error verifying OTP:",g),{success:!1,error:g.message||"Failed to verify OTP. Please try again."}}}function te(){const c=s=>{window.history.pushState({},"",s),window.dispatchEvent(new PopStateEvent("popstate")),window.scrollTo({top:0,behavior:"smooth"})},[w,g]=n.useState("form"),[r,u]=n.useState(""),[i,D]=n.useState(""),[p,z]=n.useState(""),[d,V]=n.useState(""),[_,B]=n.useState(""),[P,G]=n.useState(""),[f,O]=n.useState(!1),[o,h]=n.useState(!1),[l,a]=n.useState(""),[C,v]=n.useState(""),[k,T]=n.useState(0),[Q,ee]=n.useState(null),[E,J]=n.useState(!1),A=n.useMemo(()=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(p.trim()),[p]),U=n.useMemo(()=>{const s=d.length;return s>=8&&s<=64},[d]),$=n.useMemo(()=>{const s=/[A-Za-z]/.test(d),t=/\d/.test(d);return s&&t},[d]),H=U&&$,I=n.useMemo(()=>_===d&&_.length>0,[_,d]),W=n.useMemo(()=>r.trim().length>0&&i.trim().length>0,[r,i]),R=A&&W&&H&&I&&E,y=n.useRef(null),x=n.useRef(null);return n.useEffect(()=>{let s=!0,t=null,m=null;const j=async()=>{try{if(!s||!y.current)return;const N=await M(()=>import("./vanta.cells.min-C2JetcJo.js").then(Y=>Y.v),__vite__mapDeps([0,1,2])),b=await M(()=>import("./three.module-DK_4hUQZ.js"),[]),Z=N.default||N;if(x.current&&(x.current.destroy(),x.current=null),!s||!y.current)return;const X=Z({el:y.current,THREE:b.default||b,mouseControls:!0,touchControls:!0,gyroControls:!1,minHeight:200,minWidth:200,scale:1,scaleMobile:1,color1:5339413,color2:8714152,size:1.3,speed:1.2,backgroundColor:658445});x.current=X}catch(N){console.error("Error initializing Vanta.js:",N)}};return t=setTimeout(()=>{s&&(y.current&&y.current.offsetWidth>0&&y.current.offsetHeight>0?j():m=setTimeout(()=>{s&&j()},200))},100),()=>{s=!1,t&&clearTimeout(t),m&&clearTimeout(m),x.current&&(x.current.destroy(),x.current=null)}},[]),e.jsxs("div",{className:"loginShell",children:[e.jsxs("div",{className:"loginShell__left","aria-hidden":"true",children:[e.jsxs("div",{className:"loginHero",children:[e.jsxs("h1",{className:"loginHero__headline",children:["The end-to-end IDE for"," ",e.jsx("span",{className:"loginHero__highlight",children:"Vision AI"})]}),e.jsxs("div",{className:"loginHero__pipeline",children:[e.jsx("div",{className:"loginHero__pipelineLine"}),e.jsxs("div",{className:"loginHero__pipelineNodes",children:[e.jsx("span",{className:"loginHero__pipelineNode"}),e.jsx("span",{className:"loginHero__pipelineNode"}),e.jsx("span",{className:"loginHero__pipelineNode"}),e.jsx("span",{className:"loginHero__pipelineNode"}),e.jsx("span",{className:"loginHero__pipelineNode"})]})]})]}),e.jsx("div",{ref:y,className:"loginArt loginArt--vanta"})]}),e.jsx("div",{className:"loginShell__right",children:e.jsxs("div",{className:"loginPanel",children:[e.jsx("div",{className:"loginBrand",children:"ML FORGE"}),w==="otp"?e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"loginTitle",children:"Verify your email"}),e.jsxs("p",{className:"loginSubtitle",children:["Enter the code sent to ",p.trim()||"your email","."]}),e.jsxs("form",{className:"loginForm",onSubmit:async s=>{if(s.preventDefault(),O(!0),a(""),!o&&P.trim())try{h(!0);const t=await K(p.trim(),P.trim());if(!t.success){t.requiresLogin?a("An account with this email already exists. Please log in to continue."):t.error?.includes("Invalid or expired")?a("Invalid or expired OTP code. Please request a new code."):t.error?.includes("network")||t.error?.includes("fetch")?a("Network error. Please check your connection and try again."):a(t.error||"Failed to verify OTP. Please try again."),h(!1);return}if(t.requiresPasswordLogin){v(t.message||"Account created successfully! Redirecting to login..."),setTimeout(()=>{c("/login")},2e3);return}if(!t.session&&!t.requiresLogin){a("Verification succeeded but no session was created. Please try again.");return}if(t.requiresLogin)return;if(r.trim()||i.trim()){const{error:b}=await L.auth.updateUser({data:{first_name:r.trim(),last_name:i.trim()}});b&&console.error("Error updating user metadata:",b)}const{data:{user:m}}=await L.auth.getUser(),N=m?.user_metadata?.is_admin===!0?"/admin":"/dashboard";window.location.href=N}catch(t){a(t?.message||"Unable to verify code. Please try again.")}finally{h(!1)}},children:[e.jsxs("label",{className:"loginLabel",children:["OTP code",e.jsx("input",{className:"loginInput",type:"text",inputMode:"numeric",placeholder:"123456",value:P,onChange:s=>G(s.target.value),disabled:o})]}),f&&!P.trim()&&e.jsx("div",{className:"loginHint",children:"Enter the code from your email."}),l&&e.jsxs("div",{className:`loginHint ${l.includes("already exists")||l.includes("already registered")?"loginHint--warning":"loginHint--error"}`,children:[l,(l.includes("already exists")||l.includes("already registered")||l.includes("Please log in"))&&e.jsx("div",{style:{marginTop:"12px"},children:e.jsx("a",{href:"/login",onClick:s=>{s.preventDefault(),c("/login")},style:{color:"#3b82f6",textDecoration:"underline",fontWeight:500,cursor:"pointer"},children:"Go to Login →"})})]}),e.jsx("button",{className:"button button--primary loginSubmit",type:"submit",disabled:o,children:o?"Verifying…":"Verify & Create account"}),e.jsx("button",{className:"button button--ghost loginSubmit",type:"button",disabled:o||k>0,onClick:async()=>{a(""),v("");try{h(!0);const s=await F(p.trim(),r.trim(),i.trim(),d);if(!s.success){a(s.error||"Failed to resend OTP");return}v("OTP resent. Check your email."),T(60);const t=setInterval(()=>{T(m=>m<=1?(clearInterval(t),0):m-1)},1e3)}catch(s){a(s?.message||"Unable to resend OTP.")}finally{h(!1)}},children:k>0?`Resend code (${k}s)`:"Resend code"}),C&&e.jsx("div",{className:"loginHint",children:C})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"loginTitle",children:"Let's create your account"}),e.jsx("p",{className:"loginSubtitle",children:"Email"}),e.jsxs("button",{className:"loginAccount",type:"button",disabled:o,onClick:async()=>{a(""),v(""),await L.auth.signInWithOAuth({provider:"google",options:{redirectTo:window.location.origin}})},children:[e.jsxs("div",{className:"loginAccount__left",children:[e.jsx("div",{className:"loginAccount__avatar","aria-hidden":"true"}),e.jsxs("div",{className:"loginAccount__text",children:[e.jsx("div",{className:"loginAccount__name",children:"Continue with Google"}),e.jsx("div",{className:"loginAccount__email",children:"Use a Google account"})]})]}),e.jsx("span",{className:"loginAccount__google","aria-hidden":"true",children:e.jsxs("svg",{viewBox:"0 0 48 48",width:"18",height:"18",focusable:"false","aria-hidden":"true",children:[e.jsx("path",{fill:"#EA4335",d:"M24 9.5c3.54 0 6.71 1.22 9.2 3.6l6.9-6.9C35.9 2.4 30.4 0 24 0 14.6 0 6.5 5.4 2.6 13.2l8 6.2C12.6 13.1 17.9 9.5 24 9.5z"}),e.jsx("path",{fill:"#4285F4",d:"M46.1 24.5c0-1.6-.14-2.8-.46-4.1H24v7.7h12.6c-.26 2-1.67 5-4.8 7l7.4 5.7c4.4-4.1 6.9-10.1 6.9-17.3z"}),e.jsx("path",{fill:"#FBBC05",d:"M10.6 28.7c-.54-1.6-.86-3.3-.86-5.2s.32-3.6.84-5.2l-8-6.2C.9 15.6 0 19.7 0 23.5c0 3.8.9 7.9 2.6 11.4l8-6.2z"}),e.jsx("path",{fill:"#34A853",d:"M24 48c6.4 0 11.8-2.1 15.7-5.7l-7.4-5.7c-2 1.4-4.7 2.4-8.3 2.4-6.1 0-11.4-3.6-13.5-9l-8 6.2C6.5 42.6 14.6 48 24 48z"})]})})]}),e.jsxs("form",{className:"loginForm",onSubmit:async s=>{if(s.preventDefault(),O(!0),a(""),v(""),!(!R||o))try{h(!0);const t=await F(p.trim(),r.trim(),i.trim(),d);if(!t.success){t.error?.includes("already exists")||t.error?.includes("already registered")||t.requiresLogin?a('An account with this email already exists. Please log in instead. If you signed up with Google, you can use "Continue with Google" or set a password by continuing with this signup.'):t.error?.includes("network")||t.error?.includes("fetch")?a("Network error. Please check your connection and try again."):a(t.error||"Failed to send OTP. Please try again."),h(!1);return}v("We sent an OTP to your email. Enter it to finish creating your account."),g("otp"),T(60);const m=setInterval(()=>{T(j=>j<=1?(clearInterval(m),0):j-1)},1e3)}catch(t){a(t?.message||"Unable to create account. Please try again.")}finally{h(!1)}},children:[e.jsxs("label",{className:"loginLabel",children:["First name",e.jsx("input",{className:"loginInput",type:"text",placeholder:"First name",autoComplete:"given-name",value:r,onChange:s=>u(s.target.value),disabled:o})]}),f&&!r.trim()&&e.jsx("div",{className:"loginHint",children:"Enter your first name."}),e.jsxs("label",{className:"loginLabel",children:["Last name",e.jsx("input",{className:"loginInput",type:"text",placeholder:"Last name",autoComplete:"family-name",value:i,onChange:s=>D(s.target.value),disabled:o})]}),f&&!i.trim()&&e.jsx("div",{className:"loginHint",children:"Enter your last name."}),e.jsxs("label",{className:"loginLabel",children:["Email",e.jsx("input",{className:"loginInput",type:"email",placeholder:"@ehost.cam",autoComplete:"email",value:p,onChange:s=>z(s.target.value),disabled:o})]}),f&&!A&&e.jsx("div",{className:"loginHint",children:"Enter a valid email address."}),e.jsxs("label",{className:"loginLabel",children:["Password",e.jsx("input",{className:"loginInput",type:"password",placeholder:"Create password",autoComplete:"new-password",value:d,onChange:s=>V(s.target.value),disabled:o})]}),e.jsxs("label",{className:"loginLabel",children:["Password confirmation",e.jsx("input",{className:"loginInput",type:"password",placeholder:"Confirm password",autoComplete:"new-password",value:_,onChange:s=>B(s.target.value),disabled:o})]}),f&&!I&&e.jsx("div",{className:"loginHint",children:"Passwords must match."}),e.jsx("div",{className:"loginHint",style:{marginTop:10},children:"Your password must contain:"}),e.jsx("div",{className:"loginHint",children:"Between 8 and 64 characters , At least 1 letter and 1 number"}),f&&!H&&e.jsx("div",{className:"loginHint",children:"Please meet the password requirements above."}),e.jsxs("label",{className:"loginLegalRow",style:{marginTop:12},children:[e.jsx("input",{type:"checkbox",checked:E,onChange:s=>J(s.target.checked),disabled:o}),e.jsxs("span",{children:["By signing up you agree to the"," ",e.jsx("a",{className:"loginLegalLink",href:"/terms",onClick:s=>{s.preventDefault(),c("/terms")},children:"Terms & Conditions"})," ","and the"," ",e.jsx("a",{className:"loginLegalLink",href:"/privacy",onClick:s=>{s.preventDefault(),c("/privacy")},children:"Privacy Policy"}),"."]})]}),f&&!E&&e.jsx("div",{className:"loginHint",children:"Please accept the Terms & Conditions to continue."}),l&&e.jsxs("div",{className:`loginHint ${l.includes("already exists")||l.includes("already registered")?"loginHint--warning":"loginHint--error"}`,children:[l,(l.includes("already exists")||l.includes("already registered")||l.includes("Please log in"))&&e.jsx("div",{style:{marginTop:"12px"},children:e.jsx("a",{href:"/login",onClick:s=>{s.preventDefault(),c("/login")},style:{color:"#3b82f6",textDecoration:"underline",fontWeight:500,cursor:"pointer",display:"inline-block"},children:"Go to Login →"})})]}),C&&e.jsx("div",{className:"loginHint loginHint--success",children:C}),e.jsx("button",{className:"button button--primary loginSubmit",type:"submit",disabled:!R||o,children:o?"Sending OTP…":"Continue"})]})]}),e.jsxs("div",{className:"loginRow loginRow--bottom",children:[e.jsx("span",{className:"loginMuted",children:"Already have an account?"}),e.jsx("a",{className:"loginLink",href:"/login",onClick:s=>{s.preventDefault(),c("/login")},children:"Log in"})]})]})})]})}export{te as default};
