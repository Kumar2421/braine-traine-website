const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AdminSecurityTab-B_EQrlwt.js","assets/index-UkIvKgPy.js","assets/index-CBB7irxW.css","assets/card-kPhyKK4t.js","assets/AdminReleaseTab-CC7xgboG.js"])))=>i.map(i=>d[i]);
import{s as g,r as x,u as lt,j as e,L as D,c as ct,_ as Es}from"./index-UkIvKgPy.js";import{e as bs,a as dt,b as ot,c as xt,g as ut}from"./analyticsApi-BUt_Bh-L.js";import{U as ht}from"./UsageChart-DDzAler7.js";import{c as te,O as mt,J as pt,K as jt,L as ft,i as gt,j as C,k as U,H as _s,N as yt,I as ws,Q as vt,T as Nt,Z as N,U as l,V as c,X as d,W as o,Y as j}from"./card-kPhyKK4t.js";const bt=[["path",{d:"M12 20v-9",key:"1qisl0"}],["path",{d:"M14 7a4 4 0 0 1 4 4v3a6 6 0 0 1-12 0v-3a4 4 0 0 1 4-4z",key:"uouzyp"}],["path",{d:"M14.12 3.88 16 2",key:"qol33r"}],["path",{d:"M21 21a4 4 0 0 0-3.81-4",key:"1b0z45"}],["path",{d:"M21 5a4 4 0 0 1-3.55 3.97",key:"5cxbf6"}],["path",{d:"M22 13h-4",key:"1jl80f"}],["path",{d:"M3 21a4 4 0 0 1 3.81-4",key:"1fjd4g"}],["path",{d:"M3 5a4 4 0 0 0 3.55 3.97",key:"1d7oge"}],["path",{d:"M6 13H2",key:"82j7cp"}],["path",{d:"m8 2 1.88 1.88",key:"fmnt4t"}],["path",{d:"M9 7.13V6a3 3 0 1 1 6 0v1.13",key:"1vgav8"}]],Ss=te("bug",bt);const _t=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],ks=te("chart-column",_t);const wt=[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]],St=te("cpu",wt);const kt=[["path",{d:"M4 22V4a1 1 0 0 1 .4-.8A6 6 0 0 1 8 2c3 0 5 2 7.333 2q2 0 3.067-.8A1 1 0 0 1 20 4v10a1 1 0 0 1-.4.8A6 6 0 0 1 16 16c-3 0-5-2-8-2a6 6 0 0 0-4 1.528",key:"1jaruq"}]],As=te("flag",kt);const At=[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]],Ct=te("key-round",At);const Ut=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Je=te("shield",Ut);const Et=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],Ke=te("trending-up",Et);const Ft=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Cs=te("users",Ft),G={async getAllUsers(){const{data:u,error:h}=await g.rpc("admin_get_users");if(h)throw h;return(u||[]).map(p=>({user_id:p.user_id,license_type:p.license_type,is_active:p.is_active,expires_at:p.expires_at,issued_at:p.issued_at,offline_enabled:p.offline_enabled,users:{id:p.user_id,email:p.email,created_at:p.user_created_at,raw_user_meta_data:p.raw_user_meta_data||{}}}))},async toggleUserActive(u,h){const{error:p}=await g.from("licenses").update({is_active:h}).eq("user_id",u);if(p)throw p;await W.logAction(h?"user_activate":"user_deactivate",u,{is_active:h})},async assignLicense(u,h,p=null){const{error:b}=await g.from("licenses").insert({user_id:u,license_type:h,is_active:!0,expires_at:p,issued_at:new Date().toISOString()});if(b)throw b;await W.logAction("license_assign",u,{license_type:h,expires_at:p})},async updateLicenseExpiry(u,h){const{data:p}=await g.from("licenses").select("license_id").eq("user_id",u).order("issued_at",{ascending:!1}).limit(1).single();if(p){const{error:b}=await g.from("licenses").update({expires_at:h}).eq("license_id",p.license_id);if(b)throw b;await W.logAction("license_expiry_update",u,{expires_at:h})}},async toggleOfflineLicense(u,h){const{data:p}=await g.from("licenses").select("license_id").eq("user_id",u).order("issued_at",{ascending:!1}).limit(1).single();if(p){const{error:b}=await g.from("licenses").update({offline_enabled:h}).eq("license_id",p.license_id);if(b)throw b;await W.logAction("license_offline_toggle",u,{offline_enabled:h})}},async regenerateToken(u){await W.logAction("token_regenerate",u,{timestamp:new Date().toISOString()})},async forceLogout(u){await W.logAction("force_logout",u,{timestamp:new Date().toISOString()})}},je={async getAllFlags(){const{data:u,error:h}=await g.from("feature_flags").select("*").order("category",{ascending:!0});if(h)throw h;return u},async toggleFlag(u,h){const{error:p}=await g.from("feature_flags").update({enabled:h,updated_at:new Date().toISOString()}).eq("flag_key",u);if(p)throw p;await W.logAction("feature_flag_toggle",null,{flag_key:u,enabled:h})},async emergencyDisable(){const{error:u}=await g.from("feature_flags").update({enabled:!1,updated_at:new Date().toISOString()});if(u)throw u;await W.logAction("feature_flag_toggle",null,{emergency_disable:!0})}},Us={async getUserUsage(u){const[h,p,b]=await Promise.all([g.from("projects").select("project_id, dataset_count").eq("user_id",u),g.from("downloads").select("download_id").eq("user_id",u),g.from("exports").select("export_id").eq("user_id",u)]),m=h.data?.reduce((S,E)=>S+(E.dataset_count||0),0)||0;return{projects_count:h.data?.length||0,datasets_count:m,downloads_count:p.data?.length||0,exports_count:b.data?.length||0,training_runs:h.data?.length||0,gpu_usage:null}},async getPlatformStats(){const[u,h,p,b]=await Promise.all([g.from("licenses").select("user_id",{count:"exact",head:!0}),g.from("projects").select("project_id",{count:"exact",head:!0}),g.from("downloads").select("download_id",{count:"exact",head:!0}),g.from("exports").select("export_id",{count:"exact",head:!0})]);return{total_users:u.count||0,total_projects:h.count||0,total_downloads:p.count||0,total_exports:b.count||0}}},W={async logAction(u,h,p){const{data:{user:b}}=await g.auth.getUser();if(!b)return;const{error:m}=await g.from("admin_actions").insert({admin_user_id:b.id,action_type:u,target_user_id:h,details:p});m&&console.error("Failed to log admin action:",m)},async getActions(u=100){const{data:h,error:p}=await g.from("admin_actions").select("*").order("created_at",{ascending:!1}).limit(u);if(p)throw p;return h}};async function Dt(){try{const{data:u}=await g.from("projects").select("user_id"),p=new Set(u?.map(T=>T.user_id)||[]).size,{count:b}=await g.from("subscriptions").select("*",{count:"exact",head:!0}).eq("status","active"),{count:m}=await g.from("projects").select("*",{count:"exact",head:!0}),{count:S}=await g.from("models").select("*",{count:"exact",head:!0}),{count:E}=await g.from("training_runs").select("*",{count:"exact",head:!0}),{count:q}=await g.from("exports").select("*",{count:"exact",head:!0}),{data:r}=await g.from("usage_tracking").select("gpu_hours_used"),k=r?.reduce((T,ae)=>T+parseFloat(ae.gpu_hours_used||0),0)||0,{data:v}=await g.from("subscriptions").select("plan_type, status").eq("status","active"),w={};return v?.forEach(T=>{w[T.plan_type]=(w[T.plan_type]||0)+1}),{data:{totalUsers:p||0,activeSubscriptions:b||0,totalProjects:m||0,totalModels:S||0,totalTrainingRuns:E||0,totalExports:q||0,totalGpuHours:k.toFixed(2),planDistribution:w},error:null}}catch(u){return console.error("Error fetching platform usage stats:",u),{data:null,error:u}}}async function Tt(){try{const u=new Date,h=new Date(u.getTime()-1440*60*1e3),p=new Date(u.getTime()-10080*60*1e3),{data:b,count:m}=await g.from("ide_sync_events").select("sync_status, created_at",{count:"exact"}).gte("created_at",h.toISOString()),S=b?.filter(_=>_.sync_status==="success").length||0,E=b?.filter(_=>_.sync_status==="failed").length||0,q=m>0?S/m*100:100,r=new Date(u.getTime()-3600*1e3),{count:k}=await g.from("ide_auth_tokens").select("*",{count:"exact",head:!0}).gte("last_sync_at",r.toISOString()).or("last_sync_at.is.null,expires_at.gt."+u.toISOString()),{data:v,count:w}=await g.from("feature_access_log").select("access_granted",{count:"exact"}).gte("created_at",p.toISOString()),T=v?.filter(_=>!_.access_granted).length||0,ae=w>0?T/w*100:0,{count:re}=await g.from("ide_sync_events").select("*",{count:"exact",head:!0}).gte("created_at",p.toISOString()),{count:X}=await g.from("ide_sync_events").select("*",{count:"exact",head:!0}).gte("created_at",p.toISOString()).eq("sync_status","failed"),z=re>0?X/re*100:0;let $="healthy";try{await g.from("usage_limits").select("plan_type").limit(1)}catch{$="degraded"}return{data:{syncHealth:{successRate:q.toFixed(2),totalSyncs:m||0,successfulSyncs:S,failedSyncs:E},activeSessions:k||0,accessDenialRate:ae.toFixed(2),apiErrorRate:z.toFixed(2),dbHealth:$,lastUpdated:u.toISOString()},error:null}}catch(u){return console.error("Error fetching system health metrics:",u),{data:null,error:u}}}async function Rt(u={}){try{let h=g.from("ide_sync_events").select(`
                *,
                user:user_id(
                    email
                )
            `).order("created_at",{ascending:!1});u.userId&&(h=h.eq("user_id",u.userId)),u.eventType&&(h=h.eq("event_type",u.eventType)),u.status&&(h=h.eq("sync_status",u.status)),u.startDate&&(h=h.gte("created_at",u.startDate)),u.endDate&&(h=h.lte("created_at",u.endDate));const{data:p,error:b}=await h.limit(1e3);if(b)throw b;const m={};p?.forEach(r=>{const k=r.event_type;m[k]||(m[k]={total:0,success:0,failed:0}),m[k].total+=1,r.sync_status==="success"?m[k].success+=1:r.sync_status==="failed"&&(m[k].failed+=1)});const S={success:p?.filter(r=>r.sync_status==="success").length||0,failed:p?.filter(r=>r.sync_status==="failed").length||0,partial:p?.filter(r=>r.sync_status==="partial").length||0},E=new Set(p?.map(r=>r.user_id).filter(Boolean)),q=p?.filter(r=>r.sync_status==="failed"&&r.error_message).slice(0,10).map(r=>({id:r.event_id,user:r.user?.email||"Unknown",type:r.event_type,error:r.error_message,timestamp:r.created_at}));return{data:{events:p||[],byEventType:m,byStatus:S,uniqueUsers:E.size,totalEvents:p?.length||0,recentErrors:q},error:null}}catch(h){return console.error("Error fetching IDE sync status:",h),{data:null,error:h}}}async function Pt(u={}){try{const{data:h,error:p}=await g.from("subscriptions").select("plan_type, billing_interval, current_period_start, current_period_end, status").eq("status","active");if(p)throw p;const{data:b,error:m}=await g.from("pricing_plans").select("plan_key, price_monthly, price_yearly");if(m)throw m;const S={};b?.forEach(v=>{S[v.plan_key]={monthly:v.price_monthly||0,yearly:v.price_yearly||0}});let E=0;h?.forEach(v=>{const w=S[v.plan_type];w&&(v.billing_interval==="monthly"?E+=w.monthly:v.billing_interval==="yearly"&&(E+=w.yearly/12))});const q=E*12,r={};h?.forEach(v=>{const w=S[v.plan_type];w&&(r[v.plan_type]||(r[v.plan_type]={monthly:0,yearly:0,count:0}),v.billing_interval==="monthly"?r[v.plan_type].monthly+=w.monthly:r[v.plan_type].yearly+=w.yearly,r[v.plan_type].count+=1)});const k=[];for(let v=11;v>=0;v--){const w=new Date;w.setMonth(w.getMonth()-v);const T=new Date(w.getFullYear(),w.getMonth(),1),ae=new Date(w.getFullYear(),w.getMonth()+1,0),re=h?.filter(z=>{const $=new Date(z.current_period_start),_=new Date(z.current_period_end);return $<=ae&&_>=T})||[];let X=0;re.forEach(z=>{const $=S[z.plan_type];$&&(z.billing_interval==="monthly"?X+=$.monthly:X+=$.yearly/12)}),k.push({month:T.toISOString().split("T")[0],label:T.toLocaleDateString("en-US",{month:"short",year:"numeric"}),value:X})}return{data:{mrr:E.toFixed(2),arr:q.toFixed(2),revenueByPlan:r,revenueTrend:k,totalSubscriptions:h?.length||0},error:null}}catch(h){return console.error("Error fetching revenue analytics:",h),{data:null,error:h}}}function Se(u,h="admin-export.csv"){if(!u||u.length===0){console.error("No data to export");return}const p=Object.keys(u[0]),b=[p.join(","),...u.map(q=>p.map(r=>{const k=q[r];return k==null?"":typeof k=="object"?`"${JSON.stringify(k).replace(/"/g,'""')}"`:typeof k=="string"?`"${k.replace(/"/g,'""')}"`:k}).join(","))].join(`
`),m=new Blob([b],{type:"text/csv;charset=utf-8;"}),S=document.createElement("a"),E=URL.createObjectURL(m);S.setAttribute("href",E),S.setAttribute("download",h),S.style.visibility="hidden",document.body.appendChild(S),S.click(),document.body.removeChild(S)}const Lt=x.lazy(()=>Es(()=>import("./AdminSecurityTab-B_EQrlwt.js"),__vite__mapDeps([0,1,2,3]))),It=x.lazy(()=>Es(()=>import("./AdminReleaseTab-CC7xgboG.js"),__vite__mapDeps([4,1,2,3])));function Gt({session:u,navigate:h}){const[p,b]=x.useState(!0),[m,S]=x.useState(!1),[E,q]=x.useState("super"),[r,k]=x.useState(()=>new URLSearchParams(window.location.search||"").get("tab")||"overview"),[v,w]=x.useState(()=>new URLSearchParams(window.location.search||"").get("user")||""),[T,ae]=x.useState(()=>new URLSearchParams(window.location.search||"").get("event")||""),[re,X]=x.useState(""),[z,$]=x.useState(""),[_,de]=x.useState([]),[ke,Ae]=x.useState([]),[oe,Fs]=x.useState(null),[Ce,Ds]=x.useState([]),[Ts,Rs]=x.useState({}),[Qe,Ps]=x.useState([]),[Ye,Ls]=x.useState([]),[fe,We]=x.useState([]),[Xe,Ze]=x.useState(!1),[Ue,Is]=x.useState(""),[Ee,qs]=x.useState(""),[Fe,Ms]=x.useState(""),[De,es]=x.useState([]),[Te,ss]=x.useState([]),[xe,ie]=x.useState(!1),[ne,ts]=x.useState(!0),[Re,Pe]=x.useState(""),[Le,Ie]=x.useState(""),[qe,Me]=x.useState(""),[Oe,ze]=x.useState(""),[qt,Os]=x.useState(null),[Mt,zs]=x.useState(null),[M,$s]=x.useState(null),[Z,Hs]=x.useState(null),[ee,le]=x.useState(!1),[J,Bs]=x.useState(null),[ge,Ot]=x.useState([]),[K,zt]=x.useState(null),[R,Vs]=x.useState(null),[O,Gs]=x.useState(null),[L,Js]=x.useState(null),[se,as]=x.useState([]),[$e,rs]=x.useState(!1),[ue,ye]=x.useState(""),[I,he]=x.useState(""),[me,ve]=x.useState(""),[pe,Ne]=x.useState(""),[F,be]=x.useState(null),[Ks,is]=x.useState(!1),[He,ns]=x.useState([]),[Qs,ls]=x.useState(!1),[cs,ds]=x.useState([]),[os,xs]=x.useState([]),[us,Be]=x.useState([]),[Ys,Ws]=x.useState(""),[Xs,Zs]=x.useState(""),[et,st]=x.useState(""),f=lt(),tt=x.useState(()=>{try{const t=(typeof document<"u"&&document.cookie||"").match(/(?:^|;\s*)sidebar_state=([^;]+)/);return t?decodeURIComponent(t[1]||"")==="true":!0}catch{return!0}})[0],H=s=>{const t=String(E||"super");return t==="super"?!0:t==="billing"?s==="billing"||s==="support":t==="support"?s==="support":!1},at=s=>{switch(s){case"subscriptions":return"billing";case"licenses":return"billing";case"analytics":return"billing";case"platform-analytics":return"billing";case"revenue":return"billing";case"security":return"super";case"release":return"super";default:return"support"}};x.useEffect(()=>{if(!m)return;const s=at(r);H(s)||A("overview")},[r,E,m]);const A=s=>{const a=`/admin?tab=${encodeURIComponent(s||"users")}`;h?h(a):(window.history.pushState({},"",a),window.dispatchEvent(new PopStateEvent("popstate")))},rt=s=>{if(!s)return;const t=`/admin?tab=crash-recovery&event=${encodeURIComponent(String(s))}`;h?h(t):(window.history.pushState({},"",t),window.dispatchEvent(new PopStateEvent("popstate")))},Ve=async(s,t)=>{const a=new Date().toISOString(),i=u?.user?.id||null;try{const n={...t};"assigned_to"in n&&(n.assigned_at=n.assigned_to?a:null),"status"in n&&(n.updated_at=a,n.updated_by=i);const{error:y}=await g.from("access_requests").update(n).eq("request_id",s);if(y)throw y;We(B=>B.map(Y=>Y.request_id===s?{...Y,...n}:Y)),f.success("Updated")}catch(n){console.error("Failed to update inbox request:",n),f.error("Inbox update failed (ensure access_requests has new workflow columns): "+n.message)}};x.useEffect(()=>{const s=()=>{const t=new URLSearchParams(window.location.search||"");k(t.get("tab")||"overview"),w(t.get("user")||""),ae(t.get("event")||"")};return window.addEventListener("popstate",s),()=>window.removeEventListener("popstate",s)},[]),x.useEffect(()=>{if(!m||r!=="crash-recovery"||!T)return;let s=!0;return(async()=>{try{const{data:a,error:i}=await g.from("ide_diagnostics_events").select("*").eq("id",T).maybeSingle();if(!s)return;if(i)throw i;a&&be(a)}catch(a){if(!s)return;console.error("Failed to load crash event:",a)}})(),()=>{s=!1}},[r,m,T]),x.useEffect(()=>{if(!m||r!=="user-detail"||!v)return;let s=!0;return(async()=>{ls(!0);try{const[a,i,n]=await Promise.all([g.from("ide_diagnostics_events").select("*").eq("user_id",v).order("created_at",{ascending:!1}).limit(50),g.from("admin_actions").select("*").eq("target_user_id",v).order("created_at",{ascending:!1}).limit(50),g.from("subscriptions").select("*").eq("user_id",v).order("created_at",{ascending:!1}).limit(20)]);if(!s)return;if(a.error)throw a.error;if(i.error)throw i.error;n.error?Be([]):Be(n.data||[]),ds(a.data||[]),xs(i.data||[])}catch(a){if(!s)return;console.error("Failed to load user detail:",a),f.error("Failed to load user detail: "+a.message),ds([]),xs([]),Be([])}finally{s&&ls(!1)}})(),()=>{s=!1}},[r,m,v,f]),x.useEffect(()=>{if(!m||r!=="overview")return;let s=!0;return(async()=>{is(!0);try{const[a,i,n,y]=await Promise.all([Dt().catch(V=>({error:V})),Tt().catch(V=>({error:V})),Rt().catch(V=>({error:V})),Pt().catch(V=>({error:V}))]);if(!s)return;a?.error||Bs(a||null),i?.error||Vs(i||null),n?.error||Gs(n||null),y?.error||Js(y||null);const{data:B,error:Y}=await g.from("ide_diagnostics_events").select("*").eq("event_type","crash").order("created_at",{ascending:!1}).limit(10);if(!s)return;if(Y)throw Y;ns(B||[])}catch(a){if(!s)return;console.error("Failed to load overview:",a),f.error("Failed to load overview: "+a.message),ns([])}finally{s&&is(!1)}})(),()=>{s=!1}},[r,m,f]),x.useEffect(()=>{(async()=>{const t=await ct(h);if(S(t),t)try{let i="";i=String(i||"").trim().toLowerCase();{const{data:n}=await g.rpc("get_admin_role");q(n||"super")}}catch{q("super")}b(!1),t||f.error("Access denied. Admin privileges required.")})()},[h,f]),x.useEffect(()=>{if(!m)return;(async()=>{try{const t=await G.getAllUsers();de(t||[])}catch(t){console.error("Failed to load users:",t),f.error("Failed to load users: "+t.message)}})()},[m,f]),x.useEffect(()=>{if(!m)return;(async()=>{try{const t=await je.getAllFlags();Ae(t||[])}catch(t){console.error("Failed to load feature flags:",t),f.error("Failed to load feature flags: "+t.message)}})()},[m,f]),x.useEffect(()=>{if(!m)return;(async()=>{try{const t=await Us.getPlatformStats();Fs(t)}catch(t){console.error("Failed to load platform stats:",t)}})()},[m]),x.useEffect(()=>{if(!m||r!=="audit"&&r!=="security")return;(async()=>{try{const t=await W.getActions(50);Ds(t||[])}catch(t){console.error("Failed to load audit log:",t)}})()},[m,r]),x.useEffect(()=>{if(!m||r!=="diagnostics"&&r!=="crash-recovery"&&r!=="release")return;let s=!0;return(async()=>{rs(!0);try{let a=g.from("ide_diagnostics_events").select("*").order("created_at",{ascending:!1}).limit(200);if(I&&(a=a.eq("event_type",I)),me&&(a=a.eq("kind",me)),pe&&(a=a.eq("app_version",pe)),ue){const y=ue.trim();y&&(a=a.or(`message.ilike.%${y}%,platform.ilike.%${y}%,app_version.ilike.%${y}%,kind.ilike.%${y}%,source.ilike.%${y}%`))}const{data:i,error:n}=await a;if(n)throw n;if(!s)return;as(i||[])}catch(a){if(!s)return;console.error("Failed to load diagnostics events:",a),f.error("Failed to load diagnostics events: "+a.message),as([])}finally{s&&rs(!1)}})(),()=>{s=!1}},[r,pe,me,ue,I,m,f]),x.useEffect(()=>{r==="crash-recovery"&&he("crash"),be(null)},[r]),x.useEffect(()=>{if(!m||r!=="usage")return;const s=async()=>{const t={};for(const a of _)try{const i=await Us.getUserUsage(a.user_id);t[a.user_id]=i}catch(i){console.error(`Failed to load usage for user ${a.user_id}:`,i)}Rs(t)};_.length>0&&s()},[m,r,_]),x.useEffect(()=>{if(!m||r!=="subscriptions")return;(async()=>{try{const{data:t,error:a}=await g.from("subscriptions").select("*").order("created_at",{ascending:!1});if(a)throw a;Ps(t||[])}catch(t){console.error("Failed to load subscriptions:",t),f.error("Failed to load subscriptions: "+t.message)}})()},[m,r,f]),x.useEffect(()=>{if(!m||r!=="subscriptions")return;(async()=>{try{const{data:t,error:a}=await g.from("billing_history").select("*").order("created_at",{ascending:!1}).limit(50);if(a)throw a;Ls(t||[])}catch(t){console.error("Failed to load billing history:",t)}})()},[m,r]),x.useEffect(()=>{if(!m||r!=="inbox"&&r!=="security")return;(async()=>{Ze(!0);try{const{data:t,error:a}=await g.from("access_requests").select("*").order("created_at",{ascending:!1}).limit(200);if(a)throw a;We(t||[])}catch(t){console.error("Failed to load inbox:",t),f.error("Failed to load inbox: "+t.message),Ze(!1)}})()},[m,r]);const Ge=async s=>{const[{data:t,error:a},{data:i,error:n}]=await Promise.all([g.rpc("admin_blocklist_list",{active_only:!!s}),g.rpc("admin_security_events_recent",{limit_val:50})]);if(a)throw a;if(n)throw n;es(t||[]),ss(i||[])};x.useEffect(()=>{if(!m||r!=="security"||!H("super"))return;let s=!0;return(async()=>{ie(!0);try{await Ge(ne)}catch(a){console.error("Failed to load security data:",a),s&&(es([]),ss([]))}finally{s&&ie(!1)}})(),()=>{s=!1}},[r,m,ne,E]);const hs=async()=>{if(!H("super")){f.error("Access denied");return}const s=String(Re||"").trim(),t=String(Le||"").trim(),a=String(qe||"").trim(),i=String(Oe||"").trim();if([s?1:0,t?1:0,a?1:0].reduce((y,B)=>y+B,0)!==1){f.error("Provide exactly one of: email, ip, user_id");return}ie(!0);try{const{error:y}=await g.rpc("admin_blocklist_add",{email_val:s||null,ip_address_val:t||null,user_id_val:a||null,reason_val:i||null});if(y)throw y;Pe(""),Ie(""),Me(""),ze(""),await Ge(ne),f.success("Blocklist updated")}catch(y){console.error("Failed to add blocklist entry:",y),f.error("Failed to add blocklist entry: "+y.message)}finally{ie(!1)}},ms=async s=>{if(!H("super")){f.error("Access denied");return}if(s){ie(!0);try{const{error:t}=await g.rpc("admin_blocklist_deactivate",{block_id_val:s});if(t)throw t;await Ge(ne),f.success("Block removed")}catch(t){console.error("Failed to deactivate blocklist entry:",t),f.error("Failed to deactivate blocklist entry: "+t.message)}finally{ie(!1)}}};x.useEffect(()=>{if(!m||r!=="analytics")return;(async()=>{le(!0);try{const[t,a]=await Promise.all([dt(),ot()]);t.data&&Os(t.data),a.data&&zs(a.data)}catch(t){console.error("Failed to load analytics:",t),f.error("Failed to load analytics")}finally{le(!1)}})()},[m,r,f]),x.useEffect(()=>{if(!m||r!=="gpu-usage")return;(async()=>{le(!0);try{const t=await xt({});t.data&&$s(t.data)}catch(t){console.error("Failed to load GPU usage:",t),f.error("Failed to load GPU usage")}finally{le(!1)}})()},[m,r,f]),x.useEffect(()=>{if(!m||r!=="activity")return;(async()=>{le(!0);try{const t=await ut({});t.data&&Hs(t.data)}catch(t){console.error("Failed to load user activity:",t),f.error("Failed to load user activity")}finally{le(!1)}})()},[m,r,f]);const ps=async(s,t)=>{try{await G.toggleUserActive(s,!t),f.success(`User ${t?"deactivated":"activated"}`);const a=await G.getAllUsers();de(a||[])}catch(a){f.error("Failed to update user: "+a.message)}},js=async(s,t)=>{if(t)try{await G.assignLicense(s,t),f.success(`License ${t} assigned`);const a=await G.getAllUsers();de(a||[])}catch(a){f.error("Failed to assign license: "+a.message)}},fs=async s=>{const t=prompt("Enter expiry days from now (or leave empty for no expiry):");if(t===null)return;let a=null;if(t&&!isNaN(t)&&parseInt(t)>0){const i=new Date;i.setDate(i.getDate()+parseInt(t)),a=i.toISOString()}try{await G.updateLicenseExpiry(s,a),f.success("License expiry updated");const i=await G.getAllUsers();de(i||[])}catch(i){f.error("Failed to update expiry: "+i.message)}},gs=async(s,t)=>{try{await G.toggleOfflineLicense(s,!t),f.success(`Offline license ${t?"disabled":"enabled"}`);const a=await G.getAllUsers();de(a||[])}catch(a){f.error("Failed to update offline license: "+a.message)}},ys=async s=>{if(confirm("Regenerate token for this user?"))try{await G.regenerateToken(s),f.success("Token regeneration logged")}catch(t){f.error("Failed to regenerate token: "+t.message)}},vs=async s=>{if(confirm("Force logout this user? This will invalidate all their sessions."))try{await G.forceLogout(s),f.success("Force logout logged")}catch(t){f.error("Failed to force logout: "+t.message)}},Ns=async(s,t)=>{try{await je.toggleFlag(s,!t),f.success(`Feature ${t?"disabled":"enabled"}`);const a=await je.getAllFlags();Ae(a||[])}catch(a){f.error("Failed to update feature flag: "+a.message)}},it=async()=>{if(confirm("Emergency disable all features? This will disable all feature flags."))try{await je.emergencyDisable(),f.success("All features disabled");const s=await je.getAllFlags();Ae(s||[])}catch(s){f.error("Failed to disable features: "+s.message)}},Q=s=>{if(!s)return"Never";try{return new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return"Invalid date"}},P=s=>{if(!s)return"Never";try{return new Date(s).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Invalid date"}},_e=s=>s&&_.find(a=>(a?.users?.id||a?.user_id)===s)?.users?.email||null,we=s=>{if(!s)return;const t=`/admin?tab=user-detail&user=${encodeURIComponent(String(s))}`;h?h(t):(window.history.pushState({},"",t),window.dispatchEvent(new PopStateEvent("popstate")))},nt=s=>{const t=String(s||"").trim().toLowerCase();if(!t)return null;const a=_.find(n=>{const y=n?.users||{},B=String(n?.user_id||y?.id||"").toLowerCase();return B===t||t.length>=8&&B.startsWith(t)});return a||_.find(n=>{const y=String(n?.users?.email||"").toLowerCase();return y&&(y===t||y.includes(t))})||null};return p?e.jsx("div",{style:{display:"flex",justifyContent:"center",padding:"48px"},children:e.jsx(D,{})}):m?e.jsxs(mt,{defaultOpen:tt,className:"dark min-h-svh w-full bg-background text-foreground antialiased",style:{"--sidebar-width":"20rem","--sidebar-width-mobile":"20rem"},children:[e.jsxs(pt,{variant:"sidebar",children:[e.jsx(jt,{children:e.jsx("div",{className:"px-2 py-2 text-sm font-semibold tracking-tight",children:"Admin"})}),e.jsx(ft,{children:e.jsxs(gt,{children:[e.jsx(C,{children:e.jsxs(U,{isActive:r==="overview",onClick:()=>A("overview"),children:[e.jsx(ks,{className:"h-4 w-4"}),e.jsx("span",{children:"Overview"})]})}),H("support")&&e.jsx(C,{children:e.jsxs(U,{isActive:r==="users",onClick:()=>A("users"),children:[e.jsx(Cs,{className:"h-4 w-4"}),e.jsx("span",{children:"Users"})]})}),H("billing")&&e.jsx(C,{children:e.jsxs(U,{isActive:r==="licenses",onClick:()=>A("licenses"),children:[e.jsx(Ct,{className:"h-4 w-4"}),e.jsx("span",{children:"Licenses"})]})}),H("billing")&&e.jsx(C,{children:e.jsxs(U,{isActive:r==="subscriptions",onClick:()=>A("subscriptions"),children:[e.jsx(_s,{className:"h-4 w-4"}),e.jsx("span",{children:"Subscriptions"})]})}),H("support")&&e.jsx(C,{children:e.jsxs(U,{isActive:r==="inbox",onClick:()=>A("inbox"),children:[e.jsx(yt,{className:"h-4 w-4"}),e.jsx("span",{children:"Inbox"})]})}),e.jsx(C,{children:e.jsxs(U,{isActive:r==="features",onClick:()=>A("features"),children:[e.jsx(As,{className:"h-4 w-4"}),e.jsx("span",{children:"Feature flags"})]})}),e.jsx(C,{children:e.jsxs(U,{isActive:r==="usage",onClick:()=>A("usage"),children:[e.jsx(ks,{className:"h-4 w-4"}),e.jsx("span",{children:"Usage"})]})}),e.jsx(C,{children:e.jsxs(U,{isActive:r==="audit",onClick:()=>A("audit"),children:[e.jsx(Je,{className:"h-4 w-4"}),e.jsx("span",{children:"Audit"})]})}),H("super")&&e.jsx(C,{children:e.jsxs(U,{isActive:r==="security",onClick:()=>A("security"),children:[e.jsx(Je,{className:"h-4 w-4"}),e.jsx("span",{children:"Security"})]})}),H("super")&&e.jsx(C,{children:e.jsxs(U,{isActive:r==="release",onClick:()=>A("release"),children:[e.jsx(Ke,{className:"h-4 w-4"}),e.jsx("span",{children:"Release"})]})}),H("billing")&&e.jsx(C,{children:e.jsxs(U,{isActive:r==="analytics",onClick:()=>A("analytics"),children:[e.jsx(Ke,{className:"h-4 w-4"}),e.jsx("span",{children:"Analytics"})]})}),e.jsx(C,{children:e.jsxs(U,{isActive:r==="gpu-usage",onClick:()=>A("gpu-usage"),children:[e.jsx(St,{className:"h-4 w-4"}),e.jsx("span",{children:"GPU usage"})]})}),e.jsx(C,{children:e.jsxs(U,{isActive:r==="activity",onClick:()=>A("activity"),children:[e.jsx(ws,{className:"h-4 w-4"}),e.jsx("span",{children:"Activity"})]})}),e.jsx(C,{children:e.jsxs(U,{isActive:r==="diagnostics",onClick:()=>A("diagnostics"),children:[e.jsx(Ss,{className:"h-4 w-4"}),e.jsx("span",{children:"Diagnostics"})]})}),e.jsx(C,{children:e.jsxs(U,{isActive:r==="crash-recovery",onClick:()=>A("crash-recovery"),children:[e.jsx(Ss,{className:"h-4 w-4"}),e.jsx("span",{children:"Crash recovery"})]})}),e.jsx(C,{children:e.jsxs(U,{isActive:r==="platform-analytics",onClick:()=>A("platform-analytics"),children:[e.jsx(Ke,{className:"h-4 w-4"}),e.jsx("span",{children:"Platform analytics"})]})}),e.jsx(C,{children:e.jsxs(U,{isActive:r==="user-analytics",onClick:()=>A("user-analytics"),children:[e.jsx(Cs,{className:"h-4 w-4"}),e.jsx("span",{children:"User analytics"})]})}),e.jsx(C,{children:e.jsxs(U,{isActive:r==="feature-adoption",onClick:()=>A("feature-adoption"),children:[e.jsx(As,{className:"h-4 w-4"}),e.jsx("span",{children:"Feature adoption"})]})}),e.jsx(C,{children:e.jsxs(U,{isActive:r==="system-health",onClick:()=>A("system-health"),children:[e.jsx(Je,{className:"h-4 w-4"}),e.jsx("span",{children:"System health"})]})}),e.jsx(C,{children:e.jsxs(U,{isActive:r==="ide-sync",onClick:()=>A("ide-sync"),children:[e.jsx(ws,{className:"h-4 w-4"}),e.jsx("span",{children:"IDE sync status"})]})}),e.jsx(C,{children:e.jsxs(U,{isActive:r==="revenue",onClick:()=>A("revenue"),children:[e.jsx(_s,{className:"h-4 w-4"}),e.jsx("span",{children:"Revenue"})]})})]})})]}),e.jsxs(vt,{className:"min-w-0 flex-1 w-auto min-h-0 md:min-h-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 border-b p-2 sm:p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Nt,{}),e.jsxs("div",{className:"leading-tight",children:[e.jsx("div",{className:"text-sm font-semibold tracking-tight",children:"Admin Panel"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Platform administration"})]})]}),e.jsxs("div",{className:"flex w-full max-w-md items-center gap-2",children:[e.jsx("input",{type:"text",value:re,onChange:s=>X(s.target.value),placeholder:"Search user (email or user_id)…",className:"h-9 w-full rounded-md border bg-background px-3 text-sm"}),e.jsx(N,{size:"sm",variant:"outline",onClick:()=>{const s=nt(re),t=s?.users||{},a=s?.user_id||t?.id;if(!a){f.error("User not found");return}X(""),we(a)},children:"Go"})]})]}),e.jsx("div",{className:"min-h-0 flex-1 overflow-y-auto overflow-x-hidden p-2 sm:p-4",style:{scrollbarGutter:"stable"},children:e.jsxs("div",{className:"w-full space-y-4",children:[r==="overview"&&oe&&e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(l,{children:[e.jsxs(c,{className:"pb-2",children:[e.jsx(d,{children:"Total users"}),e.jsx(o,{className:"text-2xl",children:oe.total_users})]}),e.jsx(j,{})]}),e.jsxs(l,{children:[e.jsxs(c,{className:"pb-2",children:[e.jsx(d,{children:"Total projects"}),e.jsx(o,{className:"text-2xl",children:oe.total_projects})]}),e.jsx(j,{})]}),e.jsxs(l,{children:[e.jsxs(c,{className:"pb-2",children:[e.jsx(d,{children:"Total downloads"}),e.jsx(o,{className:"text-2xl",children:oe.total_downloads})]}),e.jsx(j,{})]}),e.jsxs(l,{children:[e.jsxs(c,{className:"pb-2",children:[e.jsx(d,{children:"Total exports"}),e.jsx(o,{className:"text-2xl",children:oe.total_exports})]}),e.jsx(j,{})]})]}),r==="user-detail"&&e.jsx("div",{className:"space-y-4",children:e.jsxs(l,{children:[e.jsxs(c,{children:[e.jsx(o,{children:"User detail"}),e.jsx(d,{children:"Account 360 view"})]}),e.jsx(j,{children:v?(()=>{const s=_.find(n=>{const y=n?.users||{};return String(n?.user_id||y?.id||"")===String(v)}),t=s?.users||{},a=s||{},i=!!a?.is_active;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsx(l,{children:e.jsxs(c,{className:"pb-2",children:[e.jsx(d,{children:"Email"}),e.jsx(o,{className:"text-base",children:t.email||"—"})]})}),e.jsx(l,{children:e.jsxs(c,{className:"pb-2",children:[e.jsx(d,{children:"User id"}),e.jsxs(o,{className:"text-base",children:[String(v).substring(0,12),"…"]})]})}),e.jsx(l,{children:e.jsxs(c,{className:"pb-2",children:[e.jsx(d,{children:"License"}),e.jsx(o,{className:"text-base",children:a.license_type||"free"})]})}),e.jsx(l,{children:e.jsxs(c,{className:"pb-2",children:[e.jsx(d,{children:"Expires"}),e.jsx(o,{className:"text-base",children:Q(a.expires_at)})]})})]}),e.jsxs(l,{children:[e.jsxs(c,{children:[e.jsx(o,{children:"Quick actions"}),e.jsx(d,{children:"Administrative actions for this user"})]}),e.jsx(j,{className:"space-y-3",children:e.jsxs("div",{className:"flex flex-col gap-2 lg:flex-row lg:items-center lg:justify-between",children:[e.jsxs("div",{className:"flex flex-1 flex-col gap-2 sm:flex-row sm:items-center",children:[e.jsxs("select",{value:z,onChange:n=>$(n.target.value),className:"h-9 w-full rounded-md border bg-background px-3 text-sm sm:max-w-xs",children:[e.jsx("option",{value:"",children:"Assign license…"}),e.jsx("option",{value:"free",children:"free"}),e.jsx("option",{value:"data_pro",children:"data_pro"}),e.jsx("option",{value:"train_pro",children:"train_pro"}),e.jsx("option",{value:"deploy_pro",children:"deploy_pro"}),e.jsx("option",{value:"enterprise",children:"enterprise"})]}),e.jsx(N,{variant:"outline",size:"sm",disabled:!z,onClick:()=>{js(v,z),$("")},children:"Apply"})]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-start gap-2",children:[e.jsx(N,{variant:"outline",size:"sm",onClick:()=>ps(v,i),children:i?"Deactivate":"Activate"}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>vs(v),children:"Force logout"}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>fs(v),children:"Update expiry"}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>gs(v,!!a?.offline_enabled),children:a?.offline_enabled?"Disable offline":"Enable offline"}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>ys(v),children:"Regenerate token"})]})]})})]}),Qs?e.jsx("div",{className:"py-10 text-center",children:e.jsx(D,{})}):e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsxs(l,{children:[e.jsxs(c,{children:[e.jsx(o,{children:"Recent IDE events"}),e.jsx(d,{children:"From ide_diagnostics_events"})]}),e.jsx(j,{children:cs.length===0?e.jsx("div",{className:"text-sm text-muted-foreground",children:"No events found."}):e.jsx("div",{className:"overflow-auto rounded-md border",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted/30 text-xs text-muted-foreground",children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Time"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Type"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Kind"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"App"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Message"})]})}),e.jsx("tbody",{children:cs.slice(0,20).map(n=>e.jsxs("tr",{className:"border-b last:border-b-0",children:[e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:P(n.created_at)}),e.jsx("td",{className:"px-3 py-2",children:n.event_type||"—"}),e.jsx("td",{className:"px-3 py-2",children:n.kind||"—"}),e.jsx("td",{className:"px-3 py-2",children:n.app_version||"—"}),e.jsx("td",{className:"px-3 py-2 max-w-[420px] truncate",children:n.message||"—"})]},String(n.id)))})]})})})]}),e.jsxs(l,{children:[e.jsxs(c,{children:[e.jsx(o,{children:"Recent admin actions"}),e.jsx(d,{children:"From admin_actions"})]}),e.jsx(j,{children:os.length===0?e.jsx("div",{className:"text-sm text-muted-foreground",children:"No admin actions for this user."}):e.jsx("div",{className:"overflow-auto rounded-md border",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted/30 text-xs text-muted-foreground",children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Time"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Admin"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Action"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Details"})]})}),e.jsx("tbody",{children:os.slice(0,20).map(n=>e.jsxs("tr",{className:"border-b last:border-b-0",children:[e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:P(n.created_at)}),e.jsx("td",{className:"px-3 py-2",children:_e(n.admin_user_id)||"N/A"}),e.jsx("td",{className:"px-3 py-2",children:String(n.action_type||"").replace(/_/g," ")}),e.jsx("td",{className:"px-3 py-2 max-w-[420px] truncate",children:n.details?JSON.stringify(n.details):"—"})]},String(n.action_id)))})]})})})]})]}),e.jsxs(l,{children:[e.jsxs(c,{children:[e.jsx(o,{children:"Subscriptions"}),e.jsx(d,{children:"Latest records"})]}),e.jsx(j,{children:us.length===0?e.jsx("div",{className:"text-sm text-muted-foreground",children:"No subscription records found for this user."}):e.jsx("div",{className:"overflow-auto rounded-md border",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted/30 text-xs text-muted-foreground",children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Created"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Status"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Plan"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Period end"})]})}),e.jsx("tbody",{children:us.slice(0,10).map(n=>e.jsxs("tr",{className:"border-b last:border-b-0",children:[e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:P(n.created_at)}),e.jsx("td",{className:"px-3 py-2",children:n.status||"—"}),e.jsx("td",{className:"px-3 py-2",children:n.plan_type||n.plan||"—"}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:Q(n.current_period_end||n.period_end)})]},String(n.subscription_id||n.id)))})]})})})]})]})})():e.jsx("div",{className:"text-sm text-muted-foreground",children:"Search and select a user to view details."})})]})}),r==="overview"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs(l,{children:[e.jsxs(c,{children:[e.jsx(o,{children:"Control Tower"}),e.jsx(d,{children:"Platform health, revenue, and recent issues"})]}),e.jsx(j,{children:Ks?e.jsx("div",{className:"py-10 text-center",children:e.jsx(D,{})}):e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsx(l,{children:e.jsxs(c,{className:"pb-2",children:[e.jsx(d,{children:"Crash events (latest 10)"}),e.jsx(o,{className:"text-2xl",children:He.length})]})}),e.jsx(l,{children:e.jsxs(c,{className:"pb-2",children:[e.jsx(d,{children:"Sync success rate"}),e.jsx(o,{className:"text-2xl",children:R?.syncHealth?.successRate!=null?`${R.syncHealth.successRate}%`:"—"})]})}),e.jsx(l,{children:e.jsxs(c,{className:"pb-2",children:[e.jsx(d,{children:"MRR"}),e.jsx(o,{className:"text-2xl",children:L?.mrr!=null?`₹${parseFloat(L.mrr).toLocaleString("en-IN")}`:"—"})]})}),e.jsx(l,{children:e.jsxs(c,{className:"pb-2",children:[e.jsx(d,{children:"Active IDE sessions"}),e.jsx(o,{className:"text-2xl",children:R?.activeSessions??"—"})]})})]})})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsxs(l,{children:[e.jsxs(c,{children:[e.jsx(o,{children:"Expiring licenses"}),e.jsx(d,{children:"Next 14 days"})]}),e.jsx(j,{children:(()=>{const s=Date.now(),t=336*60*60*1e3,a=(_||[]).map(i=>{const n=i.users||{},y=i.expires_at||null;return{userId:i.user_id||n.id,email:n.email,expiresAt:y}}).filter(i=>i.expiresAt&&new Date(i.expiresAt).getTime()-s<=t).sort((i,n)=>new Date(i.expiresAt).getTime()-new Date(n.expiresAt).getTime()).slice(0,10);return a.length===0?e.jsx("div",{className:"text-sm text-muted-foreground",children:"No expiring licenses found."}):e.jsx("div",{className:"divide-y rounded-md border",children:a.map(i=>e.jsxs("div",{className:"flex items-center justify-between gap-3 px-3 py-3 text-sm",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"truncate font-medium",children:i.email||String(i.userId||"").substring(0,8)+"…"}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[String(i.userId||"").substring(0,8),"…"]})]}),e.jsx("div",{className:"text-right text-sm",children:Q(i.expiresAt)})]},String(i.userId)))})})()})]}),e.jsxs(l,{children:[e.jsxs(c,{children:[e.jsx(o,{children:"Recent crashes"}),e.jsx(d,{children:"Latest events"})]}),e.jsx(j,{children:He.length===0?e.jsx("div",{className:"text-sm text-muted-foreground",children:"No crash events found."}):e.jsx("div",{className:"divide-y rounded-md border",children:He.map(s=>e.jsxs("div",{className:"px-3 py-3 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("div",{className:"font-medium",children:s.kind||"crash"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:P(s.created_at)})]}),e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:[(s.user_id||"").substring(0,8),"… · ",s.platform||"—"," · ",s.app_version||"—"]}),e.jsx("div",{className:"mt-1 max-w-[720px] truncate text-sm text-muted-foreground",children:s.message||"—"})]},String(s.id)))})})]})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsxs(l,{children:[e.jsx(c,{children:e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Blocklist"}),e.jsx(d,{children:"Block email, IP, or user_id (super only)"})]}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>ts(s=>!s),children:ne?"Showing active":"Showing all"})]})}),e.jsxs(j,{className:"space-y-3",children:[e.jsxs("div",{className:"grid gap-2 sm:grid-cols-2",children:[e.jsx("input",{type:"text",value:Re,onChange:s=>Pe(s.target.value),placeholder:"Email (optional)",className:"h-9 rounded-md border bg-background px-3 text-sm"}),e.jsx("input",{type:"text",value:Le,onChange:s=>Ie(s.target.value),placeholder:"IP address (optional)",className:"h-9 rounded-md border bg-background px-3 text-sm"})]}),e.jsxs("div",{className:"grid gap-2 sm:grid-cols-2",children:[e.jsx("input",{type:"text",value:qe,onChange:s=>Me(s.target.value),placeholder:"User ID (optional)",className:"h-9 rounded-md border bg-background px-3 text-sm"}),e.jsx("input",{type:"text",value:Oe,onChange:s=>ze(s.target.value),placeholder:"Reason",className:"h-9 rounded-md border bg-background px-3 text-sm"})]}),e.jsx("div",{className:"flex items-center justify-end gap-2",children:e.jsx(N,{variant:"outline",size:"sm",onClick:hs,disabled:xe,children:"Add"})}),xe?e.jsx("div",{className:"py-6 text-center",children:e.jsx(D,{})}):De.length===0?e.jsx("div",{className:"text-sm text-muted-foreground",children:"No blocklist entries."}):e.jsx("div",{className:"overflow-auto rounded-md border",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted/30 text-xs text-muted-foreground",children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Target"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Reason"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Active"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium",children:"Action"})]})}),e.jsx("tbody",{children:De.slice(0,30).map(s=>{const t=s.email||s.ip_address||s.user_id||"—";return e.jsxs("tr",{className:"border-b last:border-b-0",children:[e.jsx("td",{className:"px-3 py-2",children:String(t)}),e.jsx("td",{className:"px-3 py-2 max-w-[360px] truncate",children:s.reason||"—"}),e.jsx("td",{className:"px-3 py-2",children:s.is_active?"yes":"no"}),e.jsx("td",{className:"px-3 py-2 text-right",children:e.jsx(N,{variant:"outline",size:"sm",disabled:!s.is_active||xe,onClick:()=>ms(s.block_id),children:"Deactivate"})})]},String(s.block_id))})})]})})]})]}),e.jsxs(l,{children:[e.jsxs(c,{children:[e.jsx(o,{children:"Security events"}),e.jsx(d,{children:"Latest admin security events"})]}),e.jsx(j,{children:xe?e.jsx("div",{className:"py-6 text-center",children:e.jsx(D,{})}):Te.length===0?e.jsx("div",{className:"text-sm text-muted-foreground",children:"No events."}):e.jsx("div",{className:"overflow-auto rounded-md border",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted/30 text-xs text-muted-foreground",children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Time"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Type"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Severity"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Target"})]})}),e.jsx("tbody",{children:Te.slice(0,30).map(s=>{const t=s.email||s.ip_address||s.user_id||"—";return e.jsxs("tr",{className:"border-b last:border-b-0",children:[e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:P(s.created_at)}),e.jsx("td",{className:"px-3 py-2",children:s.event_type||"—"}),e.jsx("td",{className:"px-3 py-2",children:s.severity||"info"}),e.jsx("td",{className:"px-3 py-2",children:String(t)})]},String(s.event_id))})})]})})})]})]})]}),r==="diagnostics"&&e.jsxs(l,{children:[e.jsx(c,{children:e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Diagnostics"}),e.jsx(d,{children:"IDE diagnostics events (latest 200)"})]}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>{ye(""),he(""),ve(""),Ne("")},children:"Reset"})]})}),e.jsxs(j,{className:"space-y-3",children:[e.jsxs("div",{className:"grid gap-2 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsx("input",{type:"text",value:ue,onChange:s=>ye(s.target.value),placeholder:"Search message/platform/user/app_version…",className:"h-9 rounded-md border bg-background px-3 text-sm"}),e.jsxs("select",{className:"h-9 rounded-md border bg-background px-3 text-sm",value:I,onChange:s=>he(s.target.value),children:[e.jsx("option",{value:"",children:"All types"}),e.jsx("option",{value:"crash",children:"crash"}),e.jsx("option",{value:"perf",children:"perf"})]}),e.jsx("input",{type:"text",value:me,onChange:s=>ve(s.target.value),placeholder:"Filter kind",className:"h-9 rounded-md border bg-background px-3 text-sm"}),e.jsx("input",{type:"text",value:pe,onChange:s=>Ne(s.target.value),placeholder:"Filter app_version",className:"h-9 rounded-md border bg-background px-3 text-sm"})]}),$e?e.jsx("div",{className:"py-10 text-center",children:e.jsx(D,{})}):e.jsx("div",{className:"overflow-auto rounded-md border",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted/30 text-xs text-muted-foreground",children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Time"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"User"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Type"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Kind"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Platform"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"App"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Message"})]})}),e.jsx("tbody",{children:se.length===0?e.jsx("tr",{children:e.jsx("td",{className:"px-3 py-6 text-sm text-muted-foreground",colSpan:7,children:"No diagnostics events found."})}):se.map(s=>e.jsxs("tr",{className:"border-b last:border-b-0",children:[e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:P(s.created_at)}),e.jsxs("td",{className:"px-3 py-2 whitespace-nowrap",children:[(s.user_id||"").substring(0,8),"…"]}),e.jsx("td",{className:"px-3 py-2",children:s.event_type||"—"}),e.jsx("td",{className:"px-3 py-2",children:s.kind||"—"}),e.jsx("td",{className:"px-3 py-2",children:s.platform||"—"}),e.jsx("td",{className:"px-3 py-2",children:s.app_version||"—"}),e.jsx("td",{className:"px-3 py-2 max-w-[520px] truncate",children:s.message||"—"})]},String(s.id)))})]})})]})]}),r==="crash-recovery"&&e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs(l,{children:[e.jsx(c,{children:e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Crash Recovery"}),e.jsx(d,{children:"Crash and perf events from ide_diagnostics_events (latest 200)"})]}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>{ye(""),he("crash"),ve(""),Ne("")},children:"Reset"})]})}),e.jsxs(j,{className:"space-y-3",children:[e.jsxs("div",{className:"grid gap-2 sm:grid-cols-2",children:[e.jsx("input",{type:"text",value:ue,onChange:s=>ye(s.target.value),placeholder:"Search message/platform/app_version/kind…",className:"h-9 rounded-md border bg-background px-3 text-sm"}),e.jsx("input",{type:"text",value:pe,onChange:s=>Ne(s.target.value),placeholder:"Filter app_version",className:"h-9 rounded-md border bg-background px-3 text-sm"})]}),e.jsxs("div",{className:"grid gap-2 sm:grid-cols-2",children:[e.jsx("input",{type:"text",value:me,onChange:s=>ve(s.target.value),placeholder:"Filter kind (main/renderer/renderer-gone…)",className:"h-9 rounded-md border bg-background px-3 text-sm"}),e.jsxs("select",{className:"h-9 rounded-md border bg-background px-3 text-sm",value:I,onChange:s=>he(s.target.value),children:[e.jsx("option",{value:"crash",children:"crash"}),e.jsx("option",{value:"perf",children:"perf"})]})]})]})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsxs(l,{children:[e.jsxs(c,{children:[e.jsx(o,{children:"Distribution: app_version"}),e.jsx(d,{children:"Top versions by event count"})]}),e.jsx(j,{children:(()=>{const t=(se||[]).filter(i=>!I||i?.event_type===I).reduce((i,n)=>{const y=String(n?.app_version||"unknown");return i[y]=(i[y]||0)+1,i},{}),a=Object.entries(t).sort((i,n)=>n[1]-i[1]).slice(0,8);return a.length===0?e.jsx("div",{className:"text-sm text-muted-foreground",children:"No events."}):e.jsx("div",{className:"divide-y rounded-md border",children:a.map(([i,n])=>e.jsxs("div",{className:"flex items-center justify-between gap-3 px-3 py-3 text-sm",children:[e.jsx("div",{className:"font-medium",children:i}),e.jsx("div",{className:"text-muted-foreground",children:n})]},i))})})()})]}),e.jsxs(l,{children:[e.jsxs(c,{children:[e.jsx(o,{children:"Distribution: platform"}),e.jsx(d,{children:"Top platforms by event count"})]}),e.jsx(j,{children:(()=>{const t=(se||[]).filter(i=>!I||i?.event_type===I).reduce((i,n)=>{const y=String(n?.platform||"unknown");return i[y]=(i[y]||0)+1,i},{}),a=Object.entries(t).sort((i,n)=>n[1]-i[1]).slice(0,8);return a.length===0?e.jsx("div",{className:"text-sm text-muted-foreground",children:"No events."}):e.jsx("div",{className:"divide-y rounded-md border",children:a.map(([i,n])=>e.jsxs("div",{className:"flex items-center justify-between gap-3 px-3 py-3 text-sm",children:[e.jsx("div",{className:"font-medium",children:i}),e.jsx("div",{className:"text-muted-foreground",children:n})]},i))})})()})]})]}),e.jsxs(l,{children:[e.jsxs(c,{children:[e.jsx(o,{children:"Top crash signatures"}),e.jsx(d,{children:"Grouped by kind + source + message"})]}),e.jsx(j,{children:(()=>{const t=(se||[]).filter(i=>!I||i?.event_type===I).reduce((i,n)=>{const y=String(n?.kind||""),B=String(n?.source||""),Y=String(n?.message||""),V=`${y}::${B}::${Y}`,ce=i[V];return ce?(ce.count+=1,n?.created_at&&(!ce.lastAt||new Date(n.created_at)>new Date(ce.lastAt))&&(ce.lastAt=n.created_at,ce.sample=n)):i[V]={key:V,kind:y,source:B,message:Y,count:1,lastAt:n?.created_at,sample:n},i},{}),a=Object.values(t).sort((i,n)=>n.count-i.count).slice(0,8);return a.length===0?e.jsx("div",{className:"text-sm text-muted-foreground",children:"No signatures."}):e.jsx("div",{className:"divide-y rounded-md border",children:a.map(i=>e.jsx("button",{type:"button",className:"w-full px-3 py-3 text-left text-sm hover:bg-muted/30",onClick:()=>be(i.sample),children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"font-medium",children:[i.kind||"—",i.source?` · ${i.source}`:""]}),e.jsx("div",{className:"mt-1 max-w-[520px] truncate text-xs text-muted-foreground",children:i.message||"—"})]}),e.jsxs("div",{className:"shrink-0 text-right",children:[e.jsx("div",{className:"font-medium",children:i.count}),e.jsx("div",{className:"text-xs text-muted-foreground",children:P(i.lastAt)})]})]})},i.key))})})()})]}),e.jsxs(l,{children:[e.jsxs(c,{children:[e.jsx(o,{children:"Event list"}),e.jsx(d,{children:"Click any row to view details"})]}),e.jsx(j,{children:$e?e.jsx("div",{className:"py-10 text-center",children:e.jsx(D,{})}):e.jsx("div",{className:"overflow-auto rounded-md border",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted/30 text-xs text-muted-foreground",children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Time"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"User"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Kind"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Platform"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"App"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Message"})]})}),e.jsx("tbody",{children:se.length===0?e.jsx("tr",{children:e.jsx("td",{className:"px-3 py-6 text-sm text-muted-foreground",colSpan:6,children:"No events found."})}):se.filter(s=>!I||s?.event_type===I).map(s=>e.jsxs("tr",{className:"cursor-pointer border-b hover:bg-muted/30 last:border-b-0",onClick:()=>be(s),children:[e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:P(s.created_at)}),e.jsxs("td",{className:"px-3 py-2 whitespace-nowrap",children:[(s.user_id||"").substring(0,8),"…"]}),e.jsx("td",{className:"px-3 py-2",children:s.kind||"—"}),e.jsx("td",{className:"px-3 py-2",children:s.platform||"—"}),e.jsx("td",{className:"px-3 py-2",children:s.app_version||"—"}),e.jsx("td",{className:"px-3 py-2 max-w-[520px] truncate",children:s.message||"—"})]},String(s.id)))})]})})})]})]}),e.jsxs(l,{children:[e.jsx(c,{children:e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Event Details"}),e.jsx(d,{children:"Message, stack trace, and payload"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(N,{variant:"outline",size:"sm",disabled:!F,onClick:()=>{navigator.clipboard?.writeText?.(String(F?.id||"")),f.success("Copied event id")},children:"Copy ID"}),e.jsx(N,{variant:"outline",size:"sm",disabled:!F,onClick:()=>{navigator.clipboard?.writeText?.(String(F?.message||"")),f.success("Copied message")},children:"Copy message"}),e.jsx(N,{variant:"outline",size:"sm",disabled:!F,onClick:()=>{navigator.clipboard?.writeText?.(String(F?.stack||"")),f.success("Copied stack")},children:"Copy stack"}),e.jsx(N,{variant:"outline",size:"sm",disabled:!F,onClick:()=>{const s=F?JSON.stringify(F,null,2):"";navigator.clipboard?.writeText?.(s),f.success("Copied event JSON")},children:"Copy JSON"})]})]})}),e.jsx(j,{className:"space-y-4",children:F?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-2 sm:grid-cols-2",children:[e.jsxs("div",{className:"rounded-md border p-3",children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Time"}),e.jsx("div",{className:"mt-1 text-sm",children:P(F.created_at)})]}),e.jsxs("div",{className:"rounded-md border p-3",children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"User"}),e.jsxs("div",{className:"mt-1 text-sm",children:[(F.user_id||"").substring(0,8),"…"]})]})]}),e.jsxs("div",{className:"grid gap-2 sm:grid-cols-2",children:[e.jsxs("div",{className:"rounded-md border p-3",children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Kind"}),e.jsx("div",{className:"mt-1 text-sm",children:F.kind||"—"})]}),e.jsxs("div",{className:"rounded-md border p-3",children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Source"}),e.jsx("div",{className:"mt-1 text-sm",children:F.source||"—"})]})]}),e.jsxs("div",{className:"rounded-md border p-3",children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Message"}),e.jsx("div",{className:"mt-1 text-sm whitespace-pre-wrap",children:F.message||"—"})]}),e.jsxs("div",{className:"rounded-md border p-3",children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Stack"}),e.jsx("pre",{className:"mt-2 max-h-[360px] overflow-auto whitespace-pre-wrap text-xs",children:F.stack||"—"})]}),e.jsxs("div",{className:"rounded-md border p-3",children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Payload"}),e.jsx("pre",{className:"mt-2 max-h-[360px] overflow-auto whitespace-pre-wrap text-xs",children:F.payload?JSON.stringify(F.payload,null,2):"—"})]})]}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"Select an event from the list to view details."})})]})]}),r==="users"&&e.jsxs(l,{children:[e.jsx(c,{children:e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Users"}),e.jsx(d,{children:"Manage accounts and access"})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Total: ",_.length]})]})}),e.jsx(j,{children:e.jsx("div",{className:"overflow-auto rounded-md border",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted/30 text-xs text-muted-foreground",children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Email"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"License"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Status"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Expires"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:_.length===0?e.jsx("tr",{children:e.jsx("td",{className:"px-3 py-6 text-sm text-muted-foreground",colSpan:5,children:"No users found. If this is a new environment, create a test account and log in once to populate user metadata."})}):_.map(s=>{const t=s.users||{},a=s;return e.jsxs("tr",{className:"border-b last:border-b-0",children:[e.jsx("td",{className:"px-3 py-2",children:t?.email||`User ${s.user_id?.substring(0,8)}`}),e.jsx("td",{className:"px-3 py-2",children:a.license_type||"free"}),e.jsx("td",{className:"px-3 py-2",children:a.is_active?"Active":"Inactive"}),e.jsx("td",{className:"px-3 py-2",children:Q(a.expires_at)}),e.jsx("td",{className:"px-3 py-2 text-right",children:e.jsxs("div",{className:"inline-flex flex-wrap justify-end gap-2",children:[e.jsx(N,{variant:"outline",size:"sm",onClick:()=>we(s.user_id||t?.id),children:"View"}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>ps(s.user_id||t?.id,a.is_active),children:a.is_active?"Deactivate":"Activate"}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>vs(s.user_id||t?.id),children:"Force Logout"})]})})]},String(t?.id||s.user_id))})})]})})})]}),r==="licenses"&&e.jsxs(l,{children:[e.jsx(c,{children:e.jsx("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:e.jsxs("div",{children:[e.jsx(o,{children:"Licenses"}),e.jsx(d,{children:"Assign plans, expiry, offline flags and tokens"})]})})}),e.jsx(j,{children:e.jsx("div",{className:"overflow-auto rounded-md border",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted/30 text-xs text-muted-foreground",children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Email"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"License"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Status"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Expires"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Offline"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:_.length===0?e.jsx("tr",{children:e.jsx("td",{className:"px-3 py-6 text-sm text-muted-foreground",colSpan:6,children:"No licenses found. Licenses are created when a user activates the desktop app or when an admin assigns a plan."})}):_.map(s=>{const t=s.users||{},a=s;return e.jsxs("tr",{className:"border-b last:border-b-0",children:[e.jsx("td",{className:"px-3 py-2",children:t?.email||`User ${s.user_id?.substring(0,8)}`}),e.jsx("td",{className:"px-3 py-2",children:a.license_type||"free"}),e.jsx("td",{className:"px-3 py-2",children:a.is_active?"Active":"Inactive"}),e.jsx("td",{className:"px-3 py-2",children:Q(a.expires_at)}),e.jsx("td",{className:"px-3 py-2",children:a.offline_enabled?"Yes":"No"}),e.jsx("td",{className:"px-3 py-2 text-right",children:e.jsxs("div",{className:"inline-flex flex-wrap justify-end gap-2",children:[e.jsxs("select",{onChange:i=>js(s.user_id||t?.id,i.target.value),className:"h-9 rounded-md border bg-background px-3 text-sm",defaultValue:"",children:[e.jsx("option",{value:"",children:"Assign Plan"}),e.jsx("option",{value:"free",children:"Free"}),e.jsx("option",{value:"data_pro",children:"Data Pro"}),e.jsx("option",{value:"train_pro",children:"Train Pro"}),e.jsx("option",{value:"deploy_pro",children:"Deploy Pro"}),e.jsx("option",{value:"enterprise",children:"Enterprise"})]}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>fs(s.user_id||t?.id),children:"Set Expiry"}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>gs(s.user_id||t?.id,a.offline_enabled),children:a.offline_enabled?"Disable Offline":"Enable Offline"}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>ys(s.user_id||t?.id),children:"Regenerate Token"})]})})]},String(t?.id||s.user_id))})})]})})})]}),r==="subscriptions"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs(l,{children:[e.jsxs(c,{children:[e.jsx(o,{children:"Subscriptions"}),e.jsx(d,{children:"Active subscriptions"})]}),e.jsx(j,{children:e.jsx("div",{className:"overflow-auto rounded-md border",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted/30 text-xs text-muted-foreground",children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"User"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Plan"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Status"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Period Start"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Period End"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Razorpay"})]})}),e.jsx("tbody",{children:Qe.length===0?e.jsx("tr",{children:e.jsx("td",{className:"px-3 py-6 text-sm text-muted-foreground",colSpan:6,children:"No subscriptions found. This is expected for a new install before anyone purchases a plan."})}):Qe.map(s=>e.jsxs("tr",{className:"border-b last:border-b-0",children:[e.jsx("td",{className:"px-3 py-2",children:_.find(t=>t.user_id===s.user_id)?.users?.email||`User ${s.user_id?.substring(0,8)}`}),e.jsx("td",{className:"px-3 py-2",children:String(s.plan_type||"").replace("_"," ")}),e.jsx("td",{className:"px-3 py-2",children:s.status||"—"}),e.jsx("td",{className:"px-3 py-2",children:Q(s.current_period_start)}),e.jsx("td",{className:"px-3 py-2",children:Q(s.current_period_end)}),e.jsx("td",{className:"px-3 py-2 font-mono text-xs",children:s.razorpay_subscription_id?String(s.razorpay_subscription_id).substring(0,20)+"…":"—"})]},String(s.subscription_id)))})]})})})]}),e.jsxs(l,{children:[e.jsxs(c,{children:[e.jsx(o,{children:"Recent payments"}),e.jsx(d,{children:"Latest 50 billing events"})]}),e.jsx(j,{children:e.jsx("div",{className:"overflow-auto rounded-md border",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted/30 text-xs text-muted-foreground",children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Date"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"User"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Amount"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Status"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Payment ID"})]})}),e.jsx("tbody",{children:Ye.length===0?e.jsx("tr",{children:e.jsx("td",{className:"px-3 py-6 text-sm text-muted-foreground",colSpan:5,children:"No payments found. Once a subscription is created, payments will appear here as invoices settle."})}):Ye.map(s=>e.jsxs("tr",{className:"border-b last:border-b-0",children:[e.jsx("td",{className:"px-3 py-2",children:Q(s.created_at)}),e.jsx("td",{className:"px-3 py-2",children:s.user_id?.substring(0,8)}),e.jsxs("td",{className:"px-3 py-2",children:["₹",(Number(s.amount||0)/100).toFixed(2)]}),e.jsx("td",{className:"px-3 py-2",children:s.status||"—"}),e.jsx("td",{className:"px-3 py-2 font-mono text-xs",children:s.razorpay_payment_id?String(s.razorpay_payment_id).substring(0,20)+"…":"—"})]},String(s.billing_id)))})]})})})]})]}),r==="inbox"&&e.jsxs(l,{children:[e.jsx(c,{children:e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Inbox"}),e.jsx(d,{children:"Access requests and follow-ups"})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Total: ",fe.length]})]})}),e.jsxs(j,{className:"space-y-3",children:[e.jsxs("div",{className:"grid gap-2 sm:grid-cols-3",children:[e.jsxs("select",{className:"h-9 rounded-md border bg-background px-3 text-sm",value:Ue,onChange:s=>Is(s.target.value),children:[e.jsx("option",{value:"",children:"All statuses"}),e.jsx("option",{value:"new",children:"new"}),e.jsx("option",{value:"investigating",children:"investigating"}),e.jsx("option",{value:"resolved",children:"resolved"})]}),e.jsxs("select",{className:"h-9 rounded-md border bg-background px-3 text-sm",value:Ee,onChange:s=>qs(s.target.value),children:[e.jsx("option",{value:"",children:"All tags"}),e.jsx("option",{value:"billing",children:"billing"}),e.jsx("option",{value:"license",children:"license"}),e.jsx("option",{value:"crash",children:"crash"}),e.jsx("option",{value:"perf",children:"perf"}),e.jsx("option",{value:"bug",children:"bug"}),e.jsx("option",{value:"other",children:"other"})]}),e.jsxs("select",{className:"h-9 rounded-md border bg-background px-3 text-sm",value:Fe,onChange:s=>Ms(s.target.value),children:[e.jsx("option",{value:"",children:"All assignments"}),e.jsx("option",{value:"me",children:"Assigned to me"}),e.jsx("option",{value:"unassigned",children:"Unassigned"})]})]}),Xe?e.jsx("div",{className:"py-10 text-center",children:e.jsx(D,{})}):e.jsx("div",{className:"overflow-auto rounded-md border",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted/30 text-xs text-muted-foreground",children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Time"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Type"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"User"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Status"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Tag"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Crash"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Message"}),e.jsx("th",{className:"px-3 py-2 text-right font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:fe.length===0?e.jsx("tr",{children:e.jsx("td",{className:"px-3 py-6 text-sm text-muted-foreground",colSpan:8,children:"No messages found. Access requests (e.g., air-gapped/offline licensing) will show up here."})}):fe.filter(s=>!(Ue&&String(s.status||"").toLowerCase()!==Ue||Ee&&String(s.tag||"").toLowerCase()!==Ee||Fe==="unassigned"&&s.assigned_to||Fe==="me"&&(!u?.user?.id||String(s.assigned_to||"")!==String(u.user.id)))).map(s=>e.jsxs("tr",{className:"border-b last:border-b-0",children:[e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:P(s.created_at)}),e.jsx("td",{className:"px-3 py-2",children:String(s.request_type||"").replace(/_/g," ")}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:s.linked_user_id?String(s.linked_user_id).substring(0,8)+"…":String(s.user_id||"").substring(0,8)+"…"}),e.jsx("td",{className:"px-3 py-2",children:e.jsxs("select",{value:s.status||"new",onChange:t=>Ve(s.request_id,{status:t.target.value}),className:"h-8 rounded-md border bg-background px-2 text-xs",children:[e.jsx("option",{value:"new",children:"new"}),e.jsx("option",{value:"investigating",children:"investigating"}),e.jsx("option",{value:"resolved",children:"resolved"})]})}),e.jsx("td",{className:"px-3 py-2",children:e.jsxs("select",{value:s.tag||"",onChange:t=>Ve(s.request_id,{tag:t.target.value}),className:"h-8 rounded-md border bg-background px-2 text-xs",children:[e.jsx("option",{value:"",children:"—"}),e.jsx("option",{value:"billing",children:"billing"}),e.jsx("option",{value:"license",children:"license"}),e.jsx("option",{value:"crash",children:"crash"}),e.jsx("option",{value:"perf",children:"perf"}),e.jsx("option",{value:"bug",children:"bug"}),e.jsx("option",{value:"other",children:"other"})]})}),e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:s.crash_event_id?String(s.crash_event_id).substring(0,8)+"…":"—"}),e.jsx("td",{className:"px-3 py-2 max-w-[520px] truncate",children:s.message||s.details||"—"}),e.jsx("td",{className:"px-3 py-2 text-right",children:e.jsxs("div",{className:"inline-flex flex-wrap justify-end gap-2",children:[e.jsx(N,{variant:"outline",size:"sm",onClick:()=>{const t=s.linked_user_id||s.user_id;t&&we(t)},children:"User"}),e.jsx(N,{variant:"outline",size:"sm",disabled:!s.crash_event_id,onClick:()=>{s.crash_event_id&&rt(s.crash_event_id)},children:"Crash"}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>{const t=s.assigned_to||null,a=u?.user?.id||null,i=t?null:a;Ve(s.request_id,{assigned_to:i})},children:s.assigned_to?"Unassign":"Assign to me"}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>handleResendInboxMessage(s.request_id),children:"Resend"})]})})]},String(s.request_id)))})]})})]})]}),r==="features"&&e.jsx("div",{className:"space-y-4",children:e.jsxs(l,{children:[e.jsx(c,{children:e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Feature flags"}),e.jsx(d,{children:"Toggle flags for experiments and rollouts"})]}),e.jsx(N,{variant:"outline",size:"sm",onClick:it,children:"Emergency Disable All"})]})}),e.jsx(j,{children:ke.length===0?e.jsx("div",{className:"text-sm text-muted-foreground",children:"No feature flags found."}):e.jsx("div",{className:"grid gap-3 md:grid-cols-2",children:ke.map(s=>e.jsxs(l,{children:[e.jsx(c,{className:"pb-2",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx(o,{className:"text-base",children:s.flag_name}),e.jsx(d,{className:"mt-1",children:s.description})]}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>Ns(s.flag_key,s.enabled),children:s.enabled?"Enabled":"Disabled"})]})}),e.jsx(j,{className:"pt-0",children:e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Category: ",String(s.category||"").replace(/_/g," ")]})})]},String(s.flag_id)))})})]})}),r==="usage"&&e.jsxs(l,{children:[e.jsxs(c,{children:[e.jsx(o,{children:"Usage overview"}),e.jsx(d,{children:"Per-user usage counters"})]}),e.jsx(j,{children:e.jsx("div",{className:"overflow-auto rounded-md border",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted/30 text-xs text-muted-foreground",children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Email"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Projects"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Datasets"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Downloads"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Exports"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Training Runs"})]})}),e.jsx("tbody",{children:_.length===0?e.jsx("tr",{children:e.jsx("td",{className:"px-3 py-6 text-sm text-muted-foreground",colSpan:6,children:"No users found. Create a test account to verify usage tracking and admin controls end-to-end."})}):_.map(s=>{const t=s.users||{},a=Ts[s.user_id]||{};return e.jsxs("tr",{className:"border-b last:border-b-0",children:[e.jsx("td",{className:"px-3 py-2",children:t?.email||`User ${s.user_id?.substring(0,8)}`}),e.jsx("td",{className:"px-3 py-2",children:a.projects_count||0}),e.jsx("td",{className:"px-3 py-2",children:a.datasets_count||0}),e.jsx("td",{className:"px-3 py-2",children:a.downloads_count||0}),e.jsx("td",{className:"px-3 py-2",children:a.exports_count||0}),e.jsx("td",{className:"px-3 py-2",children:a.training_runs||0})]},String(t?.id||s.user_id))})})]})})})]}),r==="audit"&&e.jsxs(l,{children:[e.jsxs(c,{children:[e.jsx(o,{children:"Audit log"}),e.jsx(d,{children:"Recent admin actions"})]}),e.jsx(j,{children:e.jsx("div",{className:"overflow-auto rounded-md border",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted/30 text-xs text-muted-foreground",children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Time"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Admin"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Action"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Target"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Details"})]})}),e.jsx("tbody",{children:Ce.length===0?e.jsx("tr",{children:e.jsx("td",{className:"px-3 py-6 text-sm text-muted-foreground",colSpan:5,children:"No audit log entries found. Admin actions (plan assignment, user toggles, token resets) will appear here."})}):Ce.map(s=>e.jsxs("tr",{className:"border-b last:border-b-0",children:[e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:P(s.created_at)}),e.jsx("td",{className:"px-3 py-2",children:_e(s.admin_user_id)||"N/A"}),e.jsx("td",{className:"px-3 py-2",children:String(s.action_type||"").replace(/_/g," ")}),e.jsx("td",{className:"px-3 py-2",children:_e(s.target_user_id)||"—"}),e.jsx("td",{className:"px-3 py-2 max-w-[420px] truncate",children:s.details?JSON.stringify(s.details):"—"})]},String(s.action_id)))})]})})})]}),r==="security"&&e.jsx(x.Suspense,{fallback:e.jsx("div",{className:"py-10 text-center",children:e.jsx(D,{})}),children:e.jsx(Lt,{inboxMessages:fe,inboxLoading:Xe,auditLog:Ce,securityActiveOnly:ne,setSecurityActiveOnly:ts,securityNewEmail:Re,setSecurityNewEmail:Pe,securityNewIp:Le,setSecurityNewIp:Ie,securityNewUserId:qe,setSecurityNewUserId:Me,securityNewReason:Oe,setSecurityNewReason:ze,securityLoading:xe,securityBlocklist:De,securityEvents:Te,addBlocklistEntry:hs,deactivateBlocklistEntry:ms,formatDateTime:P,getUserEmailById:_e,navigateToUserDetail:we})}),r==="release"&&e.jsx(x.Suspense,{fallback:e.jsx("div",{className:"py-10 text-center",children:e.jsx(D,{})}),children:e.jsx(It,{diagnosticsEvents:se,diagnosticsLoading:$e,featureFlags:ke,handleToggleFeature:Ns})}),r==="gpu-usage"&&e.jsx("div",{className:"space-y-4",children:e.jsxs(l,{children:[e.jsx(c,{children:e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx(o,{children:"GPU usage"}),e.jsx(d,{children:"Resource tracking and cost"})]}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>{M?.usage&&(bs(M.usage,"gpu-usage.csv"),f.success("GPU usage data exported"))},children:"Export CSV"})]})}),e.jsx(j,{className:"space-y-4",children:ee?e.jsx("div",{className:"py-10 text-center",children:e.jsx(D,{})}):M?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(l,{children:[e.jsxs(c,{className:"pb-2",children:[e.jsx(d,{children:"Total GPU hours"}),e.jsx(o,{className:"text-2xl",children:Number(M.totals?.totalHours||0).toFixed(2)})]}),e.jsx(j,{className:"text-xs text-muted-foreground",children:"All time"})]}),e.jsxs(l,{children:[e.jsxs(c,{className:"pb-2",children:[e.jsx(d,{children:"Total cost"}),e.jsxs(o,{className:"text-2xl",children:["₹",Number(M.totals?.totalCost||0).toFixed(2)]})]}),e.jsx(j,{className:"text-xs text-muted-foreground",children:"All time"})]}),e.jsxs(l,{children:[e.jsxs(c,{className:"pb-2",children:[e.jsx(d,{children:"Usage sessions"}),e.jsx(o,{className:"text-2xl",children:Number(M.totals?.count||0)})]}),e.jsx(j,{})]}),e.jsxs(l,{children:[e.jsxs(c,{className:"pb-2",children:[e.jsx(d,{children:"Avg cost / session"}),e.jsxs(o,{className:"text-2xl",children:["₹",Number(M.totals?.count||0)>0?(Number(M.totals?.totalCost||0)/Number(M.totals.count)).toFixed(2):"0.00"]})]}),e.jsx(j,{})]})]}),e.jsx("div",{className:"overflow-auto rounded-md border",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted/30 text-xs text-muted-foreground",children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"User"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"GPU"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Hours"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Cost"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Date"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Status"})]})}),e.jsx("tbody",{children:M.usage&&M.usage.length>0?M.usage.slice(0,50).map(s=>e.jsxs("tr",{className:"border-b last:border-b-0",children:[e.jsxs("td",{className:"px-3 py-2",children:[s.user_id?.substring(0,8),"…"]}),e.jsxs("td",{className:"px-3 py-2",children:[s.gpu_type," x",s.gpu_count]}),e.jsx("td",{className:"px-3 py-2",children:Number(s.hours_used||0).toFixed(2)}),e.jsxs("td",{className:"px-3 py-2",children:["₹",Number(s.total_cost||0).toFixed(2)]}),e.jsx("td",{className:"px-3 py-2",children:Q(s.usage_start)}),e.jsx("td",{className:"px-3 py-2",children:s.status||"—"})]},String(s.usage_id))):e.jsx("tr",{children:e.jsx("td",{className:"px-3 py-6 text-sm text-muted-foreground",colSpan:6,children:"No GPU usage recorded yet."})})})]})})]}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"No GPU usage data available."})})]})}),r==="platform-analytics"&&e.jsx("div",{className:"space-y-6",children:e.jsxs(l,{children:[e.jsx(c,{children:e.jsx("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:e.jsxs("div",{children:[e.jsx(o,{children:"Platform Analytics"}),e.jsx(d,{children:"Platform-wide usage and plan distribution"})]})})}),e.jsx(j,{children:ee?e.jsx("div",{className:"py-10 text-center",children:e.jsx(D,{})}):J?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-3",children:[e.jsx(l,{children:e.jsxs(c,{className:"pb-2",children:[e.jsx(d,{children:"Total users"}),e.jsx(o,{className:"text-2xl",children:J.totalUsers})]})}),e.jsx(l,{children:e.jsxs(c,{className:"pb-2",children:[e.jsx(d,{children:"Active subscriptions"}),e.jsx(o,{className:"text-2xl",children:J.activeSubscriptions})]})}),e.jsx(l,{children:e.jsxs(c,{className:"pb-2",children:[e.jsx(d,{children:"Total projects"}),e.jsx(o,{className:"text-2xl",children:J.totalProjects})]})}),e.jsx(l,{children:e.jsxs(c,{className:"pb-2",children:[e.jsx(d,{children:"Total models"}),e.jsx(o,{className:"text-2xl",children:J.totalModels})]})}),e.jsx(l,{children:e.jsxs(c,{className:"pb-2",children:[e.jsx(d,{children:"Training runs"}),e.jsx(o,{className:"text-2xl",children:J.totalTrainingRuns})]})}),e.jsx(l,{children:e.jsxs(c,{className:"pb-2",children:[e.jsx(d,{children:"Total exports"}),e.jsx(o,{className:"text-2xl",children:J.totalExports})]})}),e.jsx(l,{children:e.jsxs(c,{className:"pb-2",children:[e.jsx(d,{children:"Total GPU hours"}),e.jsx(o,{className:"text-2xl",children:J.totalGpuHours})]})})]}),Object.keys(J.planDistribution||{}).length>0&&e.jsxs(l,{children:[e.jsxs(c,{children:[e.jsx(o,{children:"Plan Distribution"}),e.jsx(d,{children:"Users by plan"})]}),e.jsx(j,{children:e.jsx("div",{className:"divide-y rounded-md border",children:Object.entries(J.planDistribution).map(([s,t])=>e.jsxs("div",{className:"flex items-center justify-between gap-3 px-3 py-3 text-sm",children:[e.jsx("div",{className:"font-medium",children:s.replace("_"," ").replace(/\b\w/g,a=>a.toUpperCase())}),e.jsxs("div",{className:"text-muted-foreground",children:[t," users"]})]},s))})})]})]}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"No platform statistics available."})})]})}),r==="user-analytics"&&e.jsx("div",{className:"space-y-6",children:e.jsxs(l,{children:[e.jsx(c,{children:e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx(o,{children:"User Analytics"}),e.jsx(d,{children:"Per-user usage and subscription metadata"})]}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>Se(ge,"user-analytics.csv"),disabled:ge.length===0,children:"Export CSV"})]})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-3 md:grid-cols-3",children:[e.jsx("input",{type:"text",placeholder:"Search by email...",value:Ys,onChange:s=>Ws(s.target.value),className:"h-9 w-full rounded-md border bg-background px-3 text-sm"}),e.jsxs("select",{value:Xs,onChange:s=>Zs(s.target.value),className:"h-9 w-full rounded-md border bg-background px-3 text-sm",children:[e.jsx("option",{value:"",children:"All Plans"}),e.jsx("option",{value:"free",children:"Free"}),e.jsx("option",{value:"data_pro",children:"Data Pro"}),e.jsx("option",{value:"train_pro",children:"Train Pro"}),e.jsx("option",{value:"deploy_pro",children:"Deploy Pro"}),e.jsx("option",{value:"enterprise",children:"Enterprise"})]}),e.jsxs("select",{value:et,onChange:s=>st(s.target.value),className:"h-9 w-full rounded-md border bg-background px-3 text-sm",children:[e.jsx("option",{value:"",children:"All Statuses"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"trialing",children:"Trialing"}),e.jsx("option",{value:"canceled",children:"Canceled"}),e.jsx("option",{value:"past_due",children:"Past Due"})]})]}),ee?e.jsx("div",{className:"py-10 text-center",children:e.jsx(D,{})}):ge.length===0?e.jsx("div",{className:"text-sm text-muted-foreground",children:"No users found."}):e.jsx("div",{className:"overflow-hidden rounded-md border",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted/30 text-xs text-muted-foreground",children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Email"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Plan"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Status"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Projects"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Exports"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"GPU hours"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Training runs"}),e.jsx("th",{className:"px-3 py-2 text-left font-medium",children:"Models"})]})}),e.jsx("tbody",{children:ge.map(s=>e.jsxs("tr",{className:"border-b last:border-b-0",children:[e.jsx("td",{className:"px-3 py-2",children:s.email}),e.jsx("td",{className:"px-3 py-2",children:s.planType.replace("_"," ")}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("span",{className:"inline-flex items-center rounded-full border px-2 py-0.5 text-xs text-muted-foreground",children:s.subscriptionStatus})}),e.jsx("td",{className:"px-3 py-2",children:s.projectsCount}),e.jsx("td",{className:"px-3 py-2",children:s.exportsCount}),e.jsx("td",{className:"px-3 py-2",children:s.gpuHoursUsed}),e.jsx("td",{className:"px-3 py-2",children:s.trainingRunsCount}),e.jsx("td",{className:"px-3 py-2",children:s.modelsCount})]},s.userId))})]})})]})]})}),r==="feature-adoption"&&e.jsx("div",{className:"space-y-6",children:e.jsxs(l,{children:[e.jsx(c,{children:e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Feature Adoption"}),e.jsx(d,{children:"Usage and adoption rates across feature gates"})]}),K&&e.jsx(N,{variant:"outline",size:"sm",onClick:()=>Se(K.features,"feature-adoption.csv"),children:"Export CSV"})]})}),e.jsx(j,{children:ee?e.jsx("div",{className:"py-10 text-center",children:e.jsx(D,{})}):K?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[e.jsx(l,{children:e.jsxs(c,{className:"pb-2",children:[e.jsx(d,{children:"Total feature checks"}),e.jsx(o,{className:"text-2xl",children:K.totalFeatureChecks})]})}),e.jsx(l,{children:e.jsxs(c,{className:"pb-2",children:[e.jsx(d,{children:"Unique features"}),e.jsx(o,{className:"text-2xl",children:K.uniqueFeatures})]})})]}),e.jsxs(l,{children:[e.jsxs(c,{children:[e.jsx(o,{children:"Top Features by Usage"}),e.jsx(d,{children:"Highest adoption features"})]}),e.jsx(j,{children:e.jsx("div",{className:"divide-y rounded-md border",children:K.features.slice(0,20).map(s=>e.jsxs("div",{className:"space-y-2 px-3 py-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 text-sm",children:[e.jsx("div",{className:"font-medium",children:s.feature.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase())}),e.jsxs("div",{className:"text-muted-foreground",children:[s.granted," / ",s.total," (",s.adoptionRate.toFixed(1),"%)"]})]}),e.jsx("div",{className:"h-1.5 w-full overflow-hidden rounded bg-muted",children:e.jsx("div",{className:"h-full bg-primary",style:{width:`${s.adoptionRate}%`}})})]},s.feature))})})]}),K.mostRequested&&K.mostRequested.length>0&&e.jsxs(l,{children:[e.jsxs(c,{children:[e.jsx(o,{children:"Most Requested Features (Access Denied)"}),e.jsx(d,{children:"Denied requests"})]}),e.jsx(j,{children:e.jsx("div",{className:"divide-y rounded-md border",children:K.mostRequested.map(s=>e.jsxs("div",{className:"flex items-center justify-between gap-3 px-3 py-3 text-sm",children:[e.jsx("div",{className:"font-medium",children:s.feature.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase())}),e.jsxs("div",{className:"text-muted-foreground",children:[s.denied," denied requests"]})]},s.feature))})})]})]}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"No feature adoption data available."})})]})}),r==="system-health"&&e.jsx("div",{className:"space-y-6",children:e.jsxs(l,{children:[e.jsxs(c,{children:[e.jsx(o,{children:"System Health"}),e.jsx(d,{children:"Sync success, error rates, and service health"})]}),e.jsx(j,{children:ee?e.jsx("div",{className:"py-10 text-center",children:e.jsx(D,{})}):R?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-3",children:[e.jsxs(l,{children:[e.jsxs(c,{className:"pb-2",children:[e.jsx(d,{children:"Sync success rate"}),e.jsxs(o,{className:"text-2xl",children:[R.syncHealth.successRate,"%"]})]}),e.jsxs(j,{className:"text-xs text-muted-foreground",children:[R.syncHealth.successfulSyncs," / ",R.syncHealth.totalSyncs]})]}),e.jsxs(l,{children:[e.jsxs(c,{className:"pb-2",children:[e.jsx(d,{children:"Active IDE sessions"}),e.jsx(o,{className:"text-2xl",children:R.activeSessions})]}),e.jsx(j,{className:"text-xs text-muted-foreground",children:"Last hour"})]}),e.jsxs(l,{children:[e.jsxs(c,{className:"pb-2",children:[e.jsx(d,{children:"Access denial rate"}),e.jsxs(o,{className:"text-2xl",children:[R.accessDenialRate,"%"]})]}),e.jsx(j,{className:"text-xs text-muted-foreground",children:"Last 7 days"})]}),e.jsxs(l,{children:[e.jsxs(c,{className:"pb-2",children:[e.jsx(d,{children:"API error rate"}),e.jsxs(o,{className:"text-2xl",children:[R.apiErrorRate,"%"]})]}),e.jsx(j,{className:"text-xs text-muted-foreground",children:"Last 7 days"})]}),e.jsxs(l,{children:[e.jsxs(c,{className:"pb-2",children:[e.jsx(d,{children:"Database"}),e.jsx(o,{className:"text-2xl",children:String(R.dbHealth||"").toUpperCase()})]}),e.jsx(j,{className:"text-xs text-muted-foreground",children:"Status"})]})]}),e.jsxs(l,{children:[e.jsxs(c,{children:[e.jsx(o,{children:"Sync Health Details"}),e.jsx(d,{children:"Last 24 hours"})]}),e.jsxs(j,{children:[e.jsxs("div",{className:"divide-y rounded-md border",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 px-3 py-3 text-sm",children:[e.jsx("div",{children:"Total syncs (24h)"}),e.jsx("div",{className:"font-medium",children:R.syncHealth.totalSyncs})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3 px-3 py-3 text-sm",children:[e.jsx("div",{children:"Successful"}),e.jsx("div",{className:"font-medium",children:R.syncHealth.successfulSyncs})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3 px-3 py-3 text-sm",children:[e.jsx("div",{children:"Failed"}),e.jsx("div",{className:"font-medium",children:R.syncHealth.failedSyncs})]})]}),e.jsxs("div",{className:"mt-3 text-right text-xs text-muted-foreground",children:["Last updated: ",P(R.lastUpdated)]})]})]})]}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"No system health data available."})})]})}),r==="ide-sync"&&e.jsx("div",{className:"space-y-6",children:e.jsxs(l,{children:[e.jsx(c,{children:e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx(o,{children:"IDE Sync Status"}),e.jsx(d,{children:"Events and errors from IDE-to-web sync"})]}),O&&e.jsx(N,{variant:"outline",size:"sm",onClick:()=>Se(O.events,"ide-sync-events.csv"),children:"Export CSV"})]})}),e.jsx(j,{children:ee?e.jsx("div",{className:"py-10 text-center",children:e.jsx(D,{})}):O?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsx(l,{children:e.jsxs(c,{className:"pb-2",children:[e.jsx(d,{children:"Total events"}),e.jsx(o,{className:"text-2xl",children:O.totalEvents})]})}),e.jsx(l,{children:e.jsxs(c,{className:"pb-2",children:[e.jsx(d,{children:"Unique users"}),e.jsx(o,{className:"text-2xl",children:O.uniqueUsers})]})}),e.jsx(l,{children:e.jsxs(c,{className:"pb-2",children:[e.jsx(d,{children:"Successful"}),e.jsx(o,{className:"text-2xl",children:O.byStatus.success})]})}),e.jsx(l,{children:e.jsxs(c,{className:"pb-2",children:[e.jsx(d,{children:"Failed"}),e.jsx(o,{className:"text-2xl",children:O.byStatus.failed})]})})]}),Object.keys(O.byEventType||{}).length>0&&e.jsxs(l,{children:[e.jsxs(c,{children:[e.jsx(o,{children:"Events by Type"}),e.jsx(d,{children:"Breakdown by event type"})]}),e.jsx(j,{children:e.jsx("div",{className:"divide-y rounded-md border",children:Object.entries(O.byEventType).map(([s,t])=>e.jsxs("div",{className:"flex items-center justify-between gap-3 px-3 py-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase())}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[t.success," success, ",t.failed," failed"]})]}),e.jsxs("div",{className:"text-muted-foreground",children:[t.total," total"]})]},s))})})]}),O.recentErrors&&O.recentErrors.length>0&&e.jsxs(l,{children:[e.jsxs(c,{children:[e.jsx(o,{children:"Recent Errors"}),e.jsx(d,{children:"Latest failed events"})]}),e.jsx(j,{children:e.jsx("div",{className:"space-y-3",children:O.recentErrors.map(s=>e.jsxs("div",{className:"rounded-md border bg-muted/20 p-3 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("div",{className:"font-medium",children:s.user}),e.jsx("div",{className:"text-xs text-muted-foreground",children:P(s.timestamp)})]}),e.jsx("div",{className:"mt-1 text-xs text-muted-foreground",children:s.type}),e.jsx("div",{className:"mt-1 text-xs",children:s.error})]},s.id))})})]})]}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"No IDE sync data available."})})]})}),r==="revenue"&&e.jsx("div",{className:"space-y-6",children:e.jsxs(l,{children:[e.jsx(c,{children:e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Revenue"}),e.jsx(d,{children:"MRR/ARR and revenue trend analytics"})]}),L&&e.jsx(N,{variant:"outline",size:"sm",onClick:()=>Se(L.revenueTrend,"revenue-trend.csv"),children:"Export Revenue Trend"})]})}),e.jsx(j,{children:ee?e.jsx("div",{className:"py-10 text-center",children:e.jsx(D,{})}):L?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-3",children:[e.jsx(l,{children:e.jsxs(c,{className:"pb-2",children:[e.jsx(d,{children:"Monthly recurring revenue (MRR)"}),e.jsxs(o,{className:"text-2xl",children:["₹",parseFloat(L.mrr).toLocaleString("en-IN")]})]})}),e.jsx(l,{children:e.jsxs(c,{className:"pb-2",children:[e.jsx(d,{children:"Annual recurring revenue (ARR)"}),e.jsxs(o,{className:"text-2xl",children:["₹",parseFloat(L.arr).toLocaleString("en-IN")]})]})}),e.jsx(l,{children:e.jsxs(c,{className:"pb-2",children:[e.jsx(d,{children:"Total subscriptions"}),e.jsx(o,{className:"text-2xl",children:L.totalSubscriptions})]})})]}),L.revenueTrend&&L.revenueTrend.length>0&&e.jsxs(l,{children:[e.jsxs(c,{children:[e.jsx(o,{children:"Revenue Trend"}),e.jsx(d,{children:"Last 12 months"})]}),e.jsx(j,{children:e.jsx(ht,{data:L.revenueTrend,type:"line",title:"MRR",height:300})})]}),Object.keys(L.revenueByPlan||{}).length>0&&e.jsxs(l,{children:[e.jsxs(c,{children:[e.jsx(o,{children:"Revenue by Plan"}),e.jsx(d,{children:"Monthly equivalent"})]}),e.jsx(j,{children:e.jsx("div",{className:"divide-y rounded-md border",children:Object.entries(L.revenueByPlan).map(([s,t])=>e.jsxs("div",{className:"flex items-start justify-between gap-3 px-3 py-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.replace("_"," ").replace(/\b\w/g,a=>a.toUpperCase())}),e.jsxs("div",{className:"mt-0.5 text-xs text-muted-foreground",children:[t.count," subscriptions"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium",children:["₹",((t.monthly||0)+(t.yearly||0)/12).toFixed(2)]}),e.jsx("div",{className:"mt-0.5 text-xs text-muted-foreground",children:"Monthly"})]})]},s))})})]})]}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"No revenue data available."})})]})}),r==="activity"&&e.jsxs(l,{children:[e.jsx(c,{children:e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Activity"}),e.jsx(d,{children:"Latest user activity events"})]}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>{Z?.activities&&(bs(Z.activities,"user-activity.csv"),f.success("User activity data exported"))},children:"Export CSV"})]})}),e.jsx(j,{className:"space-y-4",children:ee?e.jsx("div",{className:"py-10 text-center",children:e.jsx(D,{})}):Z?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(l,{children:[e.jsxs(c,{className:"pb-2",children:[e.jsx(d,{children:"Total activities"}),e.jsx(o,{className:"text-2xl",children:Z.total})]}),e.jsx(j,{className:"text-xs text-muted-foreground",children:"All time"})]}),Object.entries(Z.grouped||{}).slice(0,3).map(([s,t])=>e.jsxs(l,{children:[e.jsxs(c,{className:"pb-2",children:[e.jsx(d,{children:s.replace(/_/g," ")}),e.jsx(o,{className:"text-2xl",children:t})]}),e.jsx(j,{className:"text-xs text-muted-foreground",children:"Events"})]},s))]}),e.jsxs("div",{className:"overflow-hidden rounded-md border",children:[e.jsx("div",{className:"bg-muted/30 px-3 py-2 text-xs font-medium text-muted-foreground",children:"Recent activity"}),e.jsx("div",{className:"divide-y",children:Z.activities&&Z.activities.length>0?Z.activities.slice(0,50).map(s=>e.jsxs("div",{className:"flex items-start justify-between gap-3 px-3 py-3 text-sm",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-semibold tracking-tight",children:String(s.activity_type||"").replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase())}),e.jsx("div",{className:"text-xs text-muted-foreground",children:P(s.created_at)})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[String(s.user_id||"").substring(0,8),"…"]})]},s.activity_id)):e.jsx("div",{className:"px-3 py-6 text-sm text-muted-foreground",children:"No activity recorded yet."})})]})]}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"No activity data available."})})]})]})})]})]}):null}export{Gt as default};
