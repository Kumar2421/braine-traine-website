import{s}from"./index-UkIvKgPy.js";const h={async getProjects(r){try{const{data:e,error:t}=await s.from("projects").select("*").eq("user_id",r).order("updated_at",{ascending:!1});if(t)throw t;return{data:e,error:null}}catch(e){return console.error("Error fetching projects:",e),{data:null,error:e}}},async createProject(r,e){try{const{data:t,error:n}=await s.from("projects").insert({user_id:r,...e}).select().single();if(n)throw n;return{data:t,error:null}}catch(t){return console.error("Error creating project:",t),{data:null,error:t}}},async updateProject(r,e){try{const{data:t,error:n}=await s.from("projects").update({...e,updated_at:new Date().toISOString()}).eq("project_id",r).select().single();if(n)throw n;return{data:t,error:null}}catch(t){return console.error("Error updating project:",t),{data:null,error:t}}},async deleteProject(r){try{const{error:e}=await s.from("projects").delete().eq("project_id",r);if(e)throw e;return{error:null}}catch(e){return console.error("Error deleting project:",e),{error:e}}}},g={async getExports(r){try{const{data:e,error:t}=await s.from("exports").select("*").eq("user_id",r).order("exported_at",{ascending:!1});if(t)throw t;return{data:e,error:null}}catch(e){return console.error("Error fetching exports:",e),{data:null,error:e}}},async recordExport(r,e){try{const{data:t,error:n}=await s.from("exports").insert({user_id:r,...e}).select().single();if(n)throw n;return{data:t,error:null}}catch(t){return console.error("Error recording export:",t),{data:null,error:t}}}};function b(r,e="An error occurred"){return r?.message?r.message:typeof r=="string"?r:e}async function _(r,e=50){try{if(!r)return{activities:[],error:new Error("User ID required")};const{data:t,error:n}=await s.from("ide_sync_events").select("*").eq("user_id",r).order("created_at",{ascending:!1}).limit(e);if(n)throw n;return{activities:(t||[]).map(o=>({id:o.event_id,type:o.event_type,timestamp:o.created_at,status:o.sync_status,data:o.event_data||{},ideVersion:o.ide_version,platform:o.ide_platform,error:o.error_message})),error:null}}catch(t){return t?.code==="42501"?{activities:[],error:null}:(console.error("Error fetching activity timeline:",t),{activities:[],error:t})}}function i(r,e){if(!r)return console.warn("subscribeToUsageTracking: userId is required"),()=>{};const t=s.channel(`usage_tracking:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"usage_tracking",filter:`user_id=eq.${r}`},n=>{e(n)}).subscribe();return()=>{s.removeChannel(t)}}function c(r,e){if(!r)return console.warn("subscribeToSubscriptionUpdates: userId is required"),()=>{};const t=s.channel(`subscriptions:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"subscriptions",filter:`user_id=eq.${r}`},n=>{e(n)}).subscribe();return()=>{s.removeChannel(t)}}function a(r,e){if(!r)return console.warn("subscribeToIDESyncEvents: userId is required"),()=>{};const t=s.channel(`ide_sync_events:${r}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"ide_sync_events",filter:`user_id=eq.${r}`},n=>{e(n)}).subscribe();return()=>{s.removeChannel(t)}}function u(r,e){if(!r)return console.warn("subscribeToModelsUpdates: userId is required"),()=>{};const t=s.channel(`models:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"models",filter:`user_id=eq.${r}`},n=>{e(n)}).subscribe();return()=>{s.removeChannel(t)}}function l(r,e){if(!r)return console.warn("subscribeToTrainingRunsUpdates: userId is required"),()=>{};const t=s.channel(`training_runs:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"training_runs",filter:`user_id=eq.${r}`},n=>{e(n)}).subscribe();return()=>{s.removeChannel(t)}}function p(r,e){if(!r)return console.warn("subscribeToProjectsUpdates: userId is required"),()=>{};const t=s.channel(`projects:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"projects",filter:`user_id=eq.${r}`},n=>{e(n)}).subscribe();return()=>{s.removeChannel(t)}}function m(r,e={}){if(!r)return console.warn("subscribeToAllUpdates: userId is required"),()=>{};const t=[];return e.usageTracking&&t.push(i(r,e.usageTracking)),e.subscription&&t.push(c(r,e.subscription)),e.ideSync&&t.push(a(r,e.ideSync)),e.models&&t.push(u(r,e.models)),e.trainingRuns&&t.push(l(r,e.trainingRuns)),e.projects&&t.push(p(r,e.projects)),()=>{t.forEach(n=>n())}}export{g as e,_ as g,b as h,h as p,m as s};
