import{r as n,j as e,u as K,L as k,s as J}from"./index-UkIvKgPy.js";import{e as Q,i as X,f as Z,v as M}from"./razorpayApi-D6uxyQ4R.js";function ee({show:p,onComplete:t}){const[y,v]=n.useState(!1);return n.useEffect(()=>{if(p){v(!0);const z=setTimeout(()=>{v(!1),t?.()},2e3);return()=>clearTimeout(z)}},[p,t]),y?e.jsx("div",{className:"success-animation-overlay",role:"dialog","aria-live":"polite","aria-label":"Payment successful",children:e.jsxs("div",{className:"success-animation-container",children:[e.jsx("div",{className:"success-checkmark",children:e.jsxs("div",{className:"success-checkmark-circle",children:[e.jsx("div",{className:"success-checkmark-stem"}),e.jsx("div",{className:"success-checkmark-kick"})]})}),e.jsx("h2",{className:"success-animation-title",children:"Payment Successful!"}),e.jsx("p",{className:"success-animation-message",children:"Your subscription has been activated."})]})}):null}function ae({navigate:p}){const t=K(),[y,v]=n.useState(null),[z,_]=n.useState(!0),[u,f]=n.useState(!1),[l,F]=n.useState(null),[m,D]=n.useState("monthly"),[c,C]=n.useState(""),[g,S]=n.useState("card"),[N,O]=n.useState(!1),[a,A]=n.useState(null),[j,R]=n.useState(!1),[h,I]=n.useState(!1),[B,s]=n.useState(null),[U,E]=n.useState(!1),[w,d]=n.useState(""),W=n.useRef(!1);n.useEffect(()=>{if(W.current){R(!0);return}const r=document.createElement("script");return r.src="https://checkout.razorpay.com/v1/checkout.js",r.async=!0,r.onload=()=>{W.current=!0,R(!0)},r.onerror=()=>{s("Failed to load payment gateway. Please check your internet connection and refresh the page."),t.error("Payment gateway failed to load")},document.body.appendChild(r),()=>{}},[t]),n.useEffect(()=>{(async()=>{_(!0),d("plan"),s(null);try{const o=new URLSearchParams(window.location.search),i=o.get("plan")||"data_pro",x=o.get("interval")||"monthly";D(x);const{data:{session:b},error:G}=await J.auth.getSession();if(G)throw new Error("Authentication check failed. Please try logging in again.");if(!b){s("You need to be logged in to complete your purchase. Redirecting to login..."),t.error("Please log in to continue"),setTimeout(()=>{p(`/login?next=${encodeURIComponent(window.location.pathname+window.location.search)}`)},2e3);return}v(b),C(b.user.email||""),d("plan");const{data:H,error:V}=await Q();if(V)throw new Error("Unable to load pricing plans. Please try again or contact support if the issue persists.");const T=H?.find(q=>q.plan_key===i);if(!T){s(`The selected plan "${i}" is not available. Redirecting to pricing page...`),t.error("Invalid plan selected"),setTimeout(()=>p("/pricing"),2e3);return}F(T)}catch(o){console.error("Error loading checkout data:",o);const i=o.message||"Failed to load checkout page. Please refresh or contact support.";s(i),t.error(i)}finally{_(!1),d("")}})()},[p,t]),n.useEffect(()=>{if(!l||!y||l.plan_key==="free"||h)return;(async()=>{I(!0),d("order"),s(null);try{const o=await X(l.plan_key,m);if(o.success)A(o.data||o);else throw new Error(o.error||"Failed to create payment order. Please try again.")}catch(o){console.error("Error creating order:",o);const i=o.message||"Unable to create payment order. Please refresh the page or contact support.";s(i),t.error(i)}finally{I(!1),d("")}})()},[l,m,y,t]);const $=async()=>{if(!l||!y){s("Missing subscription details. Please refresh the page."),t.error("Please refresh the page and try again.");return}if(!a||h){s("Payment order is still being created. Please wait a moment..."),t.info("Please wait, order is being created...");return}if(!j||!window.Razorpay){s("Payment gateway is not ready. Please refresh the page to reload the payment system."),t.error("Payment gateway not loaded. Please refresh the page.");return}if(!c||!c.includes("@")){s("Please enter a valid email address."),t.error("Invalid email address");return}f(!0),d("payment"),s(null);try{const r={key:a.key,amount:a.amount,currency:a.currency,name:a.name,description:a.description,order_id:a.orderId,prefill:{email:c,name:y.user.user_metadata?.first_name&&y.user.user_metadata?.last_name?`${y.user.user_metadata.first_name} ${y.user.user_metadata.last_name}`:c},theme:{color:"#14b8a6"},handler:async function(i){try{d("verifying");const x=await M({razorpay_order_id:i.razorpay_order_id,razorpay_payment_id:i.razorpay_payment_id,razorpay_signature:i.razorpay_signature,plan_key:l.plan_key,billing_interval:m});if(x.success)E(!0),setTimeout(()=>{p("/subscription")},2500);else{const b=x.error||"Payment verification failed. Your payment may have been processed but subscription activation failed. Please contact support with your payment ID: "+i.razorpay_payment_id;s(b),t.error("Payment verification failed. Please contact support."),f(!1),d("")}}catch(x){console.error("Payment verification error:",x);const b="Payment verification encountered an error. Your payment may have been processed. Please contact support with payment ID: "+(i?.razorpay_payment_id||"N/A");s(b),t.error("Payment verification failed. Please contact support."),f(!1),d("")}},modal:{ondismiss:function(){f(!1),d(""),t.info("Payment process cancelled. You can try again when ready.")}}};g==="bank"?r.method={netbanking:!0}:g==="cashapp"&&(r.method={upi:!0,wallet:!0}),new window.Razorpay(r).open()}catch(r){console.error("Error opening Razorpay checkout:",r);const o=r.message||"Failed to open payment gateway. Please check your internet connection and try again.";s(o),t.error("Failed to open payment gateway. Please try again."),f(!1),d("")}},Y=async()=>{if(!a||!window.Razorpay){t.error("Please wait, order is being created...");return}f(!0);try{const r={key:a.key,amount:a.amount,currency:a.currency,name:a.name,description:a.description,order_id:a.orderId,prefill:{email:c},method:{wallet:!0},handler:async function(i){const x=await M({razorpay_order_id:i.razorpay_order_id,razorpay_payment_id:i.razorpay_payment_id,razorpay_signature:i.razorpay_signature,plan_key:l.plan_key,billing_interval:m});x.success?(t.success("Payment successful!"),p("/subscription")):(t.error(x.error||"Payment verification failed"),f(!1))},modal:{ondismiss:function(){f(!1)}}};new window.Razorpay(r).open()}catch(r){console.error("Error opening Razorpay:",r),t.error("Failed to open payment gateway."),f(!1)}},P=()=>{if(!l||l.plan_key==="free")return"$0.00";const r=m==="yearly"?l.price_yearly:l.price_monthly;return r==null?"Contact Sales":Z(r)},L=()=>!l||l.plan_key==="free"?"":m==="yearly"?"per year":"per month";return z?e.jsxs("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minHeight:"80vh",gap:"16px"},role:"status","aria-live":"polite",children:[e.jsx(k,{}),e.jsx("p",{style:{color:"var(--dr-muted)",fontSize:"14px"},children:w==="plan"?"Loading plan details...":w==="order"?"Creating payment order...":"Loading checkout..."})]}):l?e.jsxs(e.Fragment,{children:[e.jsx(ee,{show:U,onComplete:()=>{E(!1),p("/subscription")}}),e.jsx("div",{style:{minHeight:"100vh",backgroundColor:"#ffffff",padding:"40px 20px"},role:"main","aria-label":"Checkout page",children:e.jsxs("div",{style:{maxWidth:"1200px",margin:"0 auto",display:"grid",gridTemplateColumns:"1fr 1fr",gap:"60px",alignItems:"start"},className:"checkout-container",children:[e.jsxs("div",{children:[B&&e.jsx("div",{role:"alert","aria-live":"assertive",style:{padding:"16px",backgroundColor:"#fef2f2",border:"1px solid #fecaca",borderRadius:"8px",marginBottom:"24px",color:"#991b1b"},children:e.jsxs("div",{style:{display:"flex",alignItems:"start",gap:"12px"},children:[e.jsx("span",{style:{fontSize:"20px"},children:"âš ï¸"}),e.jsxs("div",{style:{flex:1},children:[e.jsx("strong",{style:{display:"block",marginBottom:"4px"},children:"Error"}),e.jsx("p",{style:{margin:0,fontSize:"14px"},children:B})]}),e.jsx("button",{onClick:()=>s(null),"aria-label":"Dismiss error message",style:{background:"none",border:"none",fontSize:"20px",cursor:"pointer",color:"#991b1b",padding:"0",width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center"},children:"Ã—"})]})}),e.jsxs("button",{onClick:()=>p("/pricing"),style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"32px",cursor:"pointer",background:"none",border:"none",padding:0,textAlign:"left"},"aria-label":"Go back to pricing page",children:[e.jsx("span",{style:{fontSize:"20px"},children:"â†"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",fontWeight:"600",fontSize:"18px",color:"#000000"},children:[e.jsx("span",{style:{width:"32px",height:"32px",borderRadius:"6px",backgroundColor:"#000000",display:"flex",alignItems:"center",justifyContent:"center",color:"#ffffff",fontWeight:"bold",fontSize:"18px"},children:"M"}),e.jsx("span",{children:"ML FORGE"})]})]}),e.jsxs("h1",{style:{fontSize:"28px",fontWeight:"600",marginBottom:"16px",color:"#000000"},children:["Subscribe to ",l.plan_name]}),e.jsxs("div",{style:{display:"flex",alignItems:"baseline",gap:"8px",marginBottom:"24px"},children:[e.jsx("span",{style:{fontSize:"48px",fontWeight:"700",color:"#000000"},children:P()}),L()&&e.jsx("span",{style:{fontSize:"16px",color:"#666666",marginLeft:"4px"},children:L()})]}),e.jsxs("div",{style:{backgroundColor:"#f8f9fa",padding:"16px",borderRadius:"8px",marginBottom:"24px"},children:[e.jsx("div",{style:{fontWeight:"600",marginBottom:"8px"},children:l.plan_name}),e.jsx("div",{style:{fontSize:"14px",color:"#666666",marginBottom:"4px"},children:"Desktop-first Vision AI IDE"}),e.jsxs("div",{style:{fontSize:"14px",color:"#666666"},children:["Billed ",m==="yearly"?"annually":"monthly"]})]}),e.jsxs("div",{style:{borderTop:"1px solid #e5e7eb",paddingTop:"24px",marginTop:"24px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"16px",fontSize:"16px"},children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{style:{fontWeight:"600"},children:P()})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"16px",fontSize:"16px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx("span",{children:"Tax"}),e.jsx("span",{style:{fontSize:"12px",color:"#666666"},children:"â„¹ï¸"})]}),e.jsx("span",{style:{color:"#666666"},children:"Enter address to calculate"})]}),e.jsxs("div",{style:{borderTop:"1px solid #e5e7eb",paddingTop:"16px",marginTop:"16px",display:"flex",justifyContent:"space-between",fontSize:"18px",fontWeight:"600"},children:[e.jsx("span",{children:"Total due today"}),e.jsx("span",{children:P()})]})]})]}),e.jsxs("div",{children:[e.jsxs("button",{onClick:Y,disabled:u||!a,style:{width:"100%",padding:"14px 20px",backgroundColor:u||!a?"#d1d5db":"#FF9900",color:"#000000",border:"none",borderRadius:"8px",fontSize:"16px",fontWeight:"600",cursor:u||!a?"not-allowed":"pointer",marginBottom:"24px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[e.jsx("span",{children:"Pay with"}),e.jsx("span",{style:{fontWeight:"700"},children:"amazon"})]}),e.jsx("div",{style:{textAlign:"center",fontSize:"14px",color:"#666666",marginBottom:"24px"},children:"Use your Amazon account or wallet"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"24px"},children:[e.jsx("div",{style:{flex:1,height:"1px",backgroundColor:"#e5e7eb"}}),e.jsx("span",{style:{color:"#666666",fontSize:"14px"},children:"OR"}),e.jsx("div",{style:{flex:1,height:"1px",backgroundColor:"#e5e7eb"}})]}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",fontSize:"14px",fontWeight:"500",color:"#000000"},children:"Email"}),e.jsx("input",{type:"email",value:c,onChange:r=>{C(r.target.value),s(null)},"aria-label":"Email address for payment","aria-required":"true","aria-invalid":c&&!c.includes("@"),style:{width:"100%",padding:"12px 16px",border:c&&!c.includes("@")?"1px solid #ef4444":"1px solid #d1d5db",borderRadius:"8px",fontSize:"16px",outline:"none",transition:"border-color 0.2s"}}),c&&!c.includes("@")&&e.jsx("p",{style:{margin:"4px 0 0 0",fontSize:"12px",color:"#ef4444"},role:"alert",children:"Please enter a valid email address"})]}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("div",{style:{marginBottom:"12px",fontSize:"14px",fontWeight:"500",color:"#000000"},children:"Payment method"}),e.jsxs("label",{style:{display:"flex",alignItems:"center",padding:"16px",border:"2px solid #000000",borderRadius:"8px",marginBottom:"12px",cursor:"pointer",backgroundColor:g==="card"?"#f8f9fa":"#ffffff"},children:[e.jsx("input",{type:"radio",name:"paymentMethod",value:"card",checked:g==="card",onChange:r=>S(r.target.value),"aria-label":"Pay with credit or debit card",style:{marginRight:"12px",width:"18px",height:"18px"}}),e.jsx("span",{style:{marginRight:"auto",fontWeight:"500"},children:"Card"}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsx("span",{style:{fontSize:"20px"},children:"ðŸ’³"}),e.jsx("span",{style:{fontSize:"20px"},children:"ðŸ’³"}),e.jsx("span",{style:{fontSize:"20px"},children:"ðŸ’³"}),e.jsx("span",{style:{fontSize:"20px"},children:"ðŸ’³"})]})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",padding:"16px",border:"1px solid #d1d5db",borderRadius:"8px",marginBottom:"12px",cursor:"pointer",backgroundColor:g==="upi"?"#f8f9fa":"#ffffff"},children:[e.jsx("input",{type:"radio",name:"paymentMethod",value:"upi",checked:g==="upi",onChange:r=>S(r.target.value),"aria-label":"Pay with UPI or digital wallet",style:{marginRight:"12px",width:"18px",height:"18px"}}),e.jsx("div",{style:{width:"24px",height:"24px",backgroundColor:"#00D632",borderRadius:"4px",marginRight:"12px",display:"flex",alignItems:"center",justifyContent:"center",color:"#ffffff",fontWeight:"bold",fontSize:"12px"},children:"â‚¹"}),e.jsx("span",{style:{fontWeight:"500"},children:"UPI / Wallet"})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",padding:"16px",border:"1px solid #d1d5db",borderRadius:"8px",cursor:"pointer",backgroundColor:g==="bank"?"#f8f9fa":"#ffffff"},children:[e.jsx("input",{type:"radio",name:"paymentMethod",value:"bank",checked:g==="bank",onChange:r=>S(r.target.value),"aria-label":"Pay with net banking",style:{marginRight:"12px",width:"18px",height:"18px"}}),e.jsx("div",{style:{width:"24px",height:"24px",backgroundColor:"#10b981",borderRadius:"4px",marginRight:"12px",display:"flex",alignItems:"center",justifyContent:"center",color:"#ffffff",fontSize:"14px"},children:"ðŸ¦"}),e.jsx("span",{style:{marginRight:"auto",fontWeight:"500"},children:"Bank"}),e.jsx("span",{style:{backgroundColor:"#10b981",color:"#ffffff",padding:"2px 8px",borderRadius:"4px",fontSize:"12px",fontWeight:"600"},children:"$5 back"})]})]}),e.jsxs("label",{style:{display:"flex",alignItems:"start",marginBottom:"24px",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:N,onChange:r=>O(r.target.checked),style:{marginRight:"12px",marginTop:"4px",width:"18px",height:"18px"}}),e.jsxs("div",{style:{fontSize:"14px",color:"#666666"},children:[e.jsx("div",{style:{marginBottom:"4px"},children:"Save my information for faster checkout"}),e.jsx("div",{style:{fontSize:"12px"},children:"Pay securely at ML FORGE and everywhere Link is accepted."})]})]}),h&&e.jsxs("div",{role:"status","aria-live":"polite",style:{padding:"12px",backgroundColor:"#f0fdfa",border:"1px solid #14b8a6",borderRadius:"8px",marginBottom:"16px",display:"flex",alignItems:"center",gap:"12px",color:"#065f46"},children:[e.jsx(k,{size:"small"}),e.jsx("span",{style:{fontSize:"14px"},children:"Creating payment order..."})]}),e.jsx("button",{onClick:$,disabled:u||!c||h||!a||!j,"aria-label":u?"Processing payment":h?"Waiting for order creation":"Subscribe to plan",style:{width:"100%",padding:"16px",backgroundColor:u||h||!a||!j?"#9ca3af":"#14b8a6",color:"#ffffff",border:"none",borderRadius:"8px",fontSize:"16px",fontWeight:"600",cursor:u||h||!a||!j?"not-allowed":"pointer",marginBottom:"16px",transition:"background-color 0.2s",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:u?e.jsxs(e.Fragment,{children:[e.jsx(k,{size:"small"}),e.jsx("span",{children:w==="verifying"?"Verifying payment...":"Processing payment..."})]}):h?e.jsxs(e.Fragment,{children:[e.jsx(k,{size:"small"}),e.jsx("span",{children:"Preparing checkout..."})]}):a?j?"Subscribe":"Loading payment gateway...":"Preparing checkout..."}),e.jsx("p",{style:{fontSize:"12px",color:"#666666",textAlign:"center",lineHeight:"1.5",marginBottom:"24px"},children:"By subscribing, you authorize ML FORGE to charge you according to the terms until you cancel."}),e.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"16px",fontSize:"12px",color:"#666666"},children:[e.jsx("span",{children:"Powered by"}),e.jsx("span",{style:{fontWeight:"600"},children:"razorpay"}),e.jsx("span",{children:"â€¢"}),e.jsx("a",{href:"#",style:{color:"#666666",textDecoration:"none"},children:"Terms"}),e.jsx("span",{children:"â€¢"}),e.jsx("a",{href:"#",style:{color:"#666666",textDecoration:"none"},children:"Privacy"})]})]})]})})]}):null}export{ae as default};
