const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vanta.cells.min-C2JetcJo.js","assets/index-UkIvKgPy.js","assets/index-CBB7irxW.css"])))=>i.map(i=>d[i]);
import{u as z,r as a,j as e,s as p,i as G,_ as C}from"./index-UkIvKgPy.js";function J(){const l=z(),r=a.useMemo(()=>new URLSearchParams(window.location.search||""),[]),y=a.useMemo(()=>r.get("ide")==="1",[r]),v=a.useMemo(()=>r.get("redirect")||"",[r]),L=a.useMemo(()=>r.get("next")||"/dashboard",[r]),H=a.useMemo(()=>{const t=`${window.location.origin}/login`,i=new URLSearchParams;r.get("next")&&i.set("next",r.get("next")),r.get("ide")&&i.set("ide",r.get("ide")),r.get("redirect")&&i.set("redirect",r.get("redirect")),r.get("source")&&i.set("source",r.get("source"));const s=i.toString();return s?`${t}?${s}`:t},[r]),D=()=>{const t=new Uint8Array(24);return crypto.getRandomValues(t),Array.from(t).map(i=>i.toString(16).padStart(2,"0")).join("")},F=async()=>{const{data:t,error:i}=await p.auth.getUser();if(i)throw i;const s=t?.user?.id;if(!s)throw new Error("Unable to resolve user id.");let o="free";try{const{data:j,error:T}=await p.from("licenses").select("license_type,issued_at,is_active,expires_at").eq("user_id",s).order("issued_at",{ascending:!1}).limit(1);if(T)throw T;const R=j?.[0];R?.license_type&&(o=R.license_type)}catch{o="free"}const n=D(),g=new Date(Date.now()+300*1e3).toISOString(),{error:_}=await p.from("ide_auth_tokens").insert({token:n,user_id:s,license_type:o,expires_at:g});if(_)throw _;const m=v?new URL(v):null;return m?(m.searchParams.set("user_id",s),m.searchParams.set("license_type",o),m.searchParams.set("token",n),window.location.href=m.toString(),null):{userId:s,licenseType:o,token:n}},N=t=>{window.history.pushState({},"",t),window.dispatchEvent(new PopStateEvent("popstate")),window.scrollTo({top:0,behavior:"smooth"})},[x,U]=a.useState(""),[f,O]=a.useState(""),[b,E]=a.useState(!1),[h,S]=a.useState(!1),[P,c]=a.useState(""),[w,V]=a.useState(null),[q,B]=a.useState(!1),[W,k]=a.useState(null),d=a.useRef(null),u=a.useRef(null);a.useEffect(()=>{let t=!0,i=null,s=null;const o=async()=>{try{if(!t||!d.current)return;const n=await C(()=>import("./vanta.cells.min-C2JetcJo.js").then(j=>j.v),__vite__mapDeps([0,1,2])),g=await C(()=>import("./three.module-DK_4hUQZ.js"),[]),_=n.default||n;if(u.current&&(u.current.destroy(),u.current=null),!t||!d.current)return;const m=_({el:d.current,THREE:g.default||g,mouseControls:!0,touchControls:!0,gyroControls:!1,minHeight:200,minWidth:200,scale:1,scaleMobile:1,color1:5339413,color2:8714152,size:1.3,speed:1.2,backgroundColor:658445});u.current=m}catch(n){console.error("Error initializing Vanta.js:",n)}};return i=setTimeout(()=>{t&&(d.current&&d.current.offsetWidth>0&&d.current.offsetHeight>0?o():s=setTimeout(()=>{t&&o()},200))},100),()=>{t=!1,i&&clearTimeout(i),s&&clearTimeout(s),u.current&&(u.current.destroy(),u.current=null)}},[]);const I=a.useMemo(()=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(x.trim()),[x]),A=a.useMemo(()=>f.trim().length>=6,[f]),M=I&&A;return e.jsxs("div",{className:"loginShell",children:[e.jsxs("div",{className:"loginShell__left","aria-hidden":"true",children:[e.jsxs("div",{className:"loginHero",children:[e.jsxs("h1",{className:"loginHero__headline",children:["The end-to-end IDE for"," ",e.jsx("span",{className:"loginHero__highlight",children:"Vision AI"})]}),e.jsxs("div",{className:"loginHero__pipeline",children:[e.jsx("div",{className:"loginHero__pipelineLine"}),e.jsxs("div",{className:"loginHero__pipelineNodes",children:[e.jsx("span",{className:"loginHero__pipelineNode"}),e.jsx("span",{className:"loginHero__pipelineNode"}),e.jsx("span",{className:"loginHero__pipelineNode"}),e.jsx("span",{className:"loginHero__pipelineNode"}),e.jsx("span",{className:"loginHero__pipelineNode"})]})]})]}),e.jsx("div",{ref:d,className:"loginArt loginArt--vanta"})]}),e.jsx("div",{className:"loginShell__right",children:e.jsxs("div",{className:"loginPanel",children:[e.jsx("div",{className:"loginBrand",children:"ML FORGE"}),e.jsx("h1",{className:"loginTitle",children:"Log in"}),e.jsx("p",{className:"loginSubtitle",children:y?"Sign in to continue in the ML FORGE desktop app.":"Sign in to continue."}),e.jsxs("button",{className:"loginAccount",type:"button",disabled:h,onClick:async()=>{c(""),E(!1),await p.auth.signInWithOAuth({provider:"google",options:{redirectTo:H}})},children:[e.jsxs("div",{className:"loginAccount__left",children:[e.jsx("div",{className:"loginAccount__avatar","aria-hidden":"true"}),e.jsxs("div",{className:"loginAccount__text",children:[e.jsx("div",{className:"loginAccount__name",children:"Continue with Google"}),e.jsx("div",{className:"loginAccount__email",children:"Fastest way to sign in"})]})]}),e.jsx("span",{className:"loginAccount__google","aria-hidden":"true",children:e.jsxs("svg",{viewBox:"0 0 48 48",width:"18",height:"18",focusable:"false","aria-hidden":"true",children:[e.jsx("path",{fill:"#EA4335",d:"M24 9.5c3.54 0 6.71 1.22 9.2 3.6l6.9-6.9C35.9 2.4 30.4 0 24 0 14.6 0 6.5 5.4 2.6 13.2l8 6.2C12.6 13.1 17.9 9.5 24 9.5z"}),e.jsx("path",{fill:"#4285F4",d:"M46.1 24.5c0-1.6-.14-2.8-.46-4.1H24v7.7h12.6c-.26 2-1.67 5-4.8 7l7.4 5.7c4.4-4.1 6.9-10.1 6.9-17.3z"}),e.jsx("path",{fill:"#FBBC05",d:"M10.6 28.7c-.54-1.6-.86-3.3-.86-5.2s.32-3.6.84-5.2l-8-6.2C.9 15.6 0 19.7 0 23.5c0 3.8.9 7.9 2.6 11.4l8-6.2z"}),e.jsx("path",{fill:"#34A853",d:"M24 48c6.4 0 11.8-2.1 15.7-5.7l-7.4-5.7c-2 1.4-4.7 2.4-8.3 2.4-6.1 0-11.4-3.6-13.5-9l-8 6.2C6.5 42.6 14.6 48 24 48z"})]})})]}),e.jsxs("form",{className:"loginForm",onSubmit:async t=>{if(t.preventDefault(),E(!0),c(""),!(!M||h))try{if(S(!0),f.length<6){c("Password must be at least 6 characters"),l.error("Password must be at least 6 characters");return}const{data:i,error:s}=await p.auth.signInWithPassword({email:x.trim(),password:f});if(s){let n=s.message;s.message.includes("Invalid login credentials")||s.message.includes("Invalid")?(n='Invalid email or password. If you signed up with Google, please use "Continue with Google" to log in. Otherwise, check your credentials and try again, or use "Forgot Password" to reset.',k(!1)):s.message.includes("Email not confirmed")?n="Please verify your email address before logging in. Check your inbox for a verification email.":s.message.includes("User not found")?(n="No account found with this email. Please sign up first.",k(!1)):s.message.includes("Too many requests")||s.message.includes("rate limit")?n="Too many login attempts. Please wait a few minutes and try again.":s.message.includes("Network")||s.message.includes("fetch")||s.message.includes("Failed to fetch")?n="Network error. Please check your internet connection and try again.":s.message.includes("Email rate limit")&&(n="Too many login attempts. Please wait a few minutes before trying again."),c(n),l.error(n),console.error("Login error details:",s);return}if(!i?.session){c("Login failed. Please try again."),l.error("Login failed. Please try again.");return}if(l.success("Successfully logged in!"),y){if(!v){const g="Missing IDE redirect URL. Please restart sign-in from the IDE.";c(g),l.error(g);return}const n=await F();n&&(V(n),l.success("IDE handshake completed successfully"));return}let o=L;if(!r.get("next"))try{o=await G()?"/admin":"/dashboard"}catch(n){console.error("Error checking admin status:",n),o="/dashboard"}window.location.href=o}catch(i){const s=i?.message||"Unable to log in. Please try again.";c(s),l.error(s)}finally{S(!1)}},children:[e.jsxs("label",{className:"loginLabel",children:["Email",e.jsx("input",{className:"loginInput",type:"email",placeholder:"name@company.com",autoComplete:"email",value:x,onChange:t=>U(t.target.value),disabled:h})]}),b&&!I&&e.jsx("div",{className:"loginHint",children:"Enter a valid email address."}),e.jsxs("label",{className:"loginLabel",children:["Password",e.jsx("input",{className:"loginInput",type:"password",placeholder:"••••••••",autoComplete:"current-password",value:f,onChange:t=>O(t.target.value),disabled:h})]}),b&&!A&&e.jsx("div",{className:"loginHint",children:"Password must be at least 6 characters."}),P&&e.jsx("div",{className:"loginHint",children:P}),e.jsxs("div",{className:"loginRow",style:{justifyContent:"space-between"},children:[e.jsx("span",{className:"loginMuted"}),e.jsx("a",{className:"loginLink",href:"/forgot-password",onClick:t=>{t.preventDefault(),N("/forgot-password")},children:"Forgot password?"})]}),e.jsx("button",{className:"button button--primary loginSubmit",type:"submit",disabled:!M||h,children:h?"Logging in…":"Log in"})]}),e.jsxs("div",{className:"loginRow loginRow--bottom",children:[e.jsx("span",{className:"loginMuted",children:"Don’t you have an account?"}),e.jsx("a",{className:"loginLink",href:"/signup",onClick:t=>{t.preventDefault(),N("/signup")},children:"Sign up"})]}),y&&w&&e.jsxs("div",{className:"loginHint",style:{marginTop:10},children:["IDE handshake ready. Provide this token to the IDE within 5 minutes.",e.jsxs("div",{style:{marginTop:8,fontFamily:"ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace"},children:["user_id=",w.userId,e.jsx("br",{}),"license_type=",w.licenseType,e.jsx("br",{}),"token=",w.token]})]})]})})]})}export{J as default};
